(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();let he="",pe="";function Ke(e){he=e}function je(e){pe=e}function Ye(){return"https://api.telegram.org"}function fe(e){const t=`${Ye()}/bot${he}/${e}`,n=pe.trim();return n?n.replace(/\/+$/,"")+"/"+t:t}function Ge(e){const t=`${Ye()}/file/bot${he}/${e}`,n=pe.trim();return n?n.replace(/\/+$/,"")+"/"+t:t}async function We(e,t){const n=t?"?"+new URLSearchParams(t).toString():"";return(await fetch(fe(e)+n)).json()}async function v(e,t){return(await fetch(fe(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t||{})})).json()}async function vt(e,t){return(await fetch(fe(e),{method:"POST",body:t})).json()}async function Xe(){return We("getMe")}async function Ct(e,t=0,n=["message","edited_message","channel_post","edited_channel_post"]){return v("getUpdates",{offset:e,timeout:t,allowed_updates:n})}async function _t(e,t="typing"){return v("sendChatAction",{chat_id:e,action:t})}async function Bt(e,t){return v("sendSticker",{chat_id:e,sticker:t})}async function It(e,t){return v("deleteMessage",{chat_id:e,message_id:parseInt(t,10)})}async function qe(e){return We("getFile",{file_id:e})}async function Mt(e){return v("getChat",{chat_id:e})}async function wt(e,t,n){return v("banChatMember",{chat_id:e,user_id:t})}async function se(e,t,n={}){return v("promoteChatMember",{chat_id:e,user_id:t,can_manage_chat:n.can_manage_chat!==!1,can_delete_messages:n.can_delete_messages!==!1,can_manage_video_chats:n.can_manage_video_chats!==!1,can_restrict_members:n.can_restrict_members!==!1,can_promote_members:n.can_promote_members||!1,can_change_info:n.can_change_info!==!1,can_invite_users:n.can_invite_users!==!1,can_pin_messages:n.can_pin_messages!==!1,is_anonymous:n.is_anonymous||!1})}async function St(e,t,n={},r){return v("restrictChatMember",{chat_id:e,user_id:t,permissions:n})}async function Tt(e,t){return v("getChatMember",{chat_id:e,user_id:t})}async function Lt(e=!1){return v("deleteWebhook",{drop_pending_updates:e})}async function xt(e,t){return v("getMyCommands",{})}async function Dt(e){return v("getMyDescription",{})}async function Nt(e){return v("getMyShortDescription",{})}function Ut(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function F(e){var i,l;const t=(e||"").trim();if(!t)return"?";const n=t.split(/\s+/).filter(Boolean),r=((i=n[0])==null?void 0:i[0])||"",s=((l=n[1])==null?void 0:l[0])||"";return(r+s).toUpperCase()||r.toUpperCase()||"?"}function oe(e){return(e||"").replace(/\s+/g," ").slice(0,60)}function At(e){return e.from?[e.from.first_name,e.from.last_name].filter(Boolean).join(" ")||e.from.username||"Ng∆∞·ªùi d√πng":e.author_signature?e.author_signature:"H·ªá th·ªëng"}function Pt(e){return e.from&&e.from.username?e.from.username:null}function Ot(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.value=680,n.gain.value=.04,t.connect(n),n.connect(e.destination),t.start(),setTimeout(()=>{t.stop(),e.close()},180)}catch{}}function R(e){e&&(e.scrollTop=e.scrollHeight)}function ge(e){return e?e.scrollTop+e.clientHeight>=e.scrollHeight-20:!0}let E="",b=new Map,f=null,ye=0,M=Ve(),A=null;function Z(){return{canDeleteMessages:!1,canPromoteMembers:!1,canRestrictMembers:!1,canChangeInfo:!1,canInviteUsers:!1}}function Ve(){return{id:null,username:null,name:null,description:null,shortDescription:null,commands:[]}}function Ee(e){if(!e)return e;if(e.messageIds instanceof Set||(e.messageIds=new Set(e.messageIds||[])),!(e.members instanceof Map)){let t=[];Array.isArray(e.members)?t=e.members:e.members&&typeof e.members=="object"&&(t=Object.entries(e.members)),e.members=new Map(t.map(([n,r])=>[String(n),r]))}return e.permissions={...Z(),...e.permissions||{}},e.avatarText||(e.avatarText="?"),e}function Ft(e){if(!e||!e.id)return null;const t=String(e.id),n=e.first_name||e.firstName||"",r=e.last_name||e.lastName||"",s=e.displayName||[n,r].filter(Boolean).join(" ")||e.username||e.name||"Ng∆∞·ªùi d√πng",i=e.avatarText||F(s),l=e.status||(e.isCreator?"creator":e.isAdmin?"administrator":"member");return{id:t,firstName:n||null,lastName:r||null,username:e.username||null,displayName:s,avatarText:i,status:l,isAdmin:e.isAdmin??(l==="administrator"||l==="creator"),isCreator:e.isCreator??l==="creator",isBot:e.isBot??e.is_bot??!1,joinedDate:e.joinedDate||e.joined_date||null,lastSeen:e.lastSeen||Date.now(),raw:e.raw||null}}function Je(e){E=e}function Rt(e){const t=new Map;e&&typeof e.forEach=="function"&&e.forEach((n,r)=>{const s=Ee({...n,id:String(n.id||r)});t.set(String(r),s)}),b=t}function $t(e,t){const n=Ee({...t,id:String(e)});b.set(String(e),n)}function _(e){return b.get(String(e))}function Ht(e){b.delete(String(e))}function ze(e){f=String(e)||null}function Qe(e){ye=e}function Ze(e){M={...M,...e}}function Kt(e){A=e}function jt(){A=null}function Yt(){b=new Map,f=null,A=null,ye=0,M=Ve()}function Ae(e,t){if(!e||!t)return null;const n=$(e),r=Ft(t);if(!r)return null;const s=n.members.get(r.id)||{},i={...s,...r,avatarText:r.avatarText||s.avatarText||F(r.displayName||""),lastSeen:r.lastSeen||s.lastSeen||Date.now()};return n.members.set(r.id,i),i}function Gt(e,t){const n=_(e);return!n||!t?!1:n.members.delete(String(t))}function Wt(e,t){if(!e)return;const n=$(e);n.permissions={...n.permissions,...t}}function L(e){const t=_(e);return t?{...Z(),...t.permissions||{}}:Z()}function re(e,t){const n=_(e);return!n||n.messageIds.has(t.id)?!1:(n.messageIds.add(t.id),n.messages.push(t),n.lastText=t.type==="text"?t.text:t.caption||t.text||"["+t.type+"]",n.lastDate=t.date,!0)}function Xt(e,t){const n=_(e);if(!n)return!1;const r=n.messages.findIndex(s=>s.id===t);return r===-1?!1:(n.messages.splice(r,1),n.messageIds.delete(t),!0)}function $(e,t={}){let n=_(e);if(n)n=Ee(n);else{const r={id:String(e),type:t.type||"unknown",title:t.title||"Chat "+e,avatarText:t.avatarText||(t.title?F(t.title):"?"),messages:[],messageIds:new Set,members:new Map,permissions:Z(),lastText:"",lastDate:0,unread:0,...t};$t(e,r),n=_(e)}return n}const be="tg_bot_chat_",et="tg_bot_info_",tt="tg_last_update_id",le="tg_theme_preference",nt="tg_bot_stickers_",qt=30*24*60*60;function ke(e){try{return encodeURIComponent(JSON.stringify(e))}catch{return""}}function ve(e){try{return JSON.parse(decodeURIComponent(e))}catch{return null}}function W(e){const t=e+"=",n=document.cookie.split(";");for(let r of n)if(r=r.trim(),r.startsWith(t))return r.substring(t.length);return null}function H(e,t,n=qt/(24*60*60)){let r="";if(n){const s=new Date;s.setTime(s.getTime()+n*24*60*60*1e3),r="; expires="+s.toUTCString()}document.cookie=`${e}=${t}${r}; path=/; SameSite=Lax`}function ot(e){H(e,"",-1)}function x(e){if(!e)return null;const t=e.match(/^(\d+):/);return t?t[1]:String(Vt(e))}function Vt(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}function D(e,t){const n=x(e);if(!n)return!1;const r=be+n,s=Array.from(t.entries()).map(([i,l])=>{let c;l.members instanceof Map?c=l.members:Array.isArray(l.members)?c=new Map(l.members):l.members&&typeof l.members=="object"?c=new Map(Object.entries(l.members)):c=new Map;const u=Array.from(c.entries());return[i,{...l,messageIds:Array.from(l.messageIds||[]),members:u,permissions:{...l.permissions||{}}}]});try{const i=ke(s);return H(r,i),!0}catch(i){return console.error("Failed to save chat history:",i),!1}}function Jt(e){const t=x(e);if(!t)return new Map;const n=be+t,r=W(n);if(!r)return new Map;const s=ve(r);if(!Array.isArray(s))return new Map;const i=new Map;for(const[l,c]of s){let u=new Map;Array.isArray(c.members)?u=new Map(c.members.map(([p,d])=>[String(p),d])):c.members&&typeof c.members=="object"&&(u=new Map(Object.entries(c.members).map(([p,d])=>[String(p),d]))),i.set(l,{...c,messageIds:new Set(c.messageIds||[]),members:u,permissions:{...c.permissions||{}}})}return i}function zt(e,t){const n=x(e);if(!n)return!1;const r=et+n;try{const s=ke(t);return H(r,s),!0}catch(s){return console.error("Failed to save bot info:",s),!1}}function Qt(e){const t=x(e);if(!t)return null;const n=et+t,r=W(n);return r?ve(r):null}function Zt(){const e=W(tt);return e&&parseInt(e,10)||0}function en(e){H(tt,String(e))}function tn(e){const t=x(e);if(!t)return!1;const n=be+t;return ot(n),!0}function nn(){const e=localStorage.getItem("bot_token");if(!e)return!1;const t="chat_history_"+e,n=localStorage.getItem(t);if(n)try{const r=JSON.parse(n),s=new Map;for(const[i,l]of r)s.set(i,{...l,messageIds:new Set(l.messageIds||[])});return D(e,s),!0}catch(r){return console.warn("Migration failed:",r),!1}return!1}function on(e){if(!e){ot(le);return}H(le,encodeURIComponent(e))}function rn(){const e=W(le);return e?decodeURIComponent(e):null}function sn(e,t){const n=x(e);if(!n||!t||!t.file_id)return!1;const r=nt+n,s=rt(e);if(s.some(c=>c.file_id===t.file_id))return!0;const l=[t,...s].slice(0,100);try{const c=ke(l);return H(r,c),!0}catch(c){return console.error("Failed to save sticker:",c),!1}}function rt(e){const t=x(e);if(!t)return[];const n=nt+t,r=W(n);if(!r)return[];const s=ve(r);return Array.isArray(s)?s:[]}const ie={en:{appTitle:"Telegram Bot",loading:"Loading...",saving:"Saving...",save:"Save",cancel:"Cancel",close:"Close",delete:"Delete",refresh:"Refresh",search:"Search",ok:"OK",yes:"Yes",no:"No",you:"You",user:"User",statusDisconnected:"Not connected (missing token)",statusConnecting:"Connecting...",statusConnected:"Receiving updates...",statusError:"Error: {error}",noChatSelected:"No chat selected",noConversations:"No conversations yet. When messages arrive, they will appear here.",enterChatId:"Enter chat ID or @username",openChat:"Open chat",enterMessage:"Type a message...",noConversationSelected:"No conversation selected",send:"Send",attach:"Attach",sticker:"Sticker",replyingTo:"Replying to:",cancelReply:"Cancel reply",newMessage:"‚Üì New message",deleteMessage:"Delete message",confirmDelete:"Are you sure you want to delete this message?",messageDeleted:"Message deleted",messageSendFailed:"Send failed: {error}",networkError:"Network error: {error}",photo:"Photo",file:"File",unsupportedContent:"[Cannot display this content type]",animatedSticker:"[Animated sticker]",settingsTitle:"Settings",botConnection:"Bot Connection",botToken:"Bot Token (botXXXXXXXX:YYYYYYYYYYYYYYYY)",corsProxy:"CORS proxy prefix (optional, e.g.: https://cors.isomorphic-git.org/)",testConnection:"Test",deleteWebhook:"Delete webhook",enableNotifications:"Enable notifications",saveAndConnect:"Save & Connect",settingsHint:"If you get a 409 error while polling, delete the webhook. If you have CORS issues, add a proxy prefix.",enterToken:"‚ùå Enter Bot Token!",tokenMissing:"Token not found.",connectionOk:"‚úÖ OK: @{username} ‚Ä¢ id={id}",connectionNoUsername:"(no username)",connectionFailed:"‚ùå getMe error: {error}",connectionNetworkError:"‚ùå CORS or network error: {error}",webhookDeleted:"‚úÖ Webhook deleted.",webhookDeleteFailed:"‚ùå Could not delete: {error}",webhookDeleteNetworkError:"‚ùå Network error deleting webhook: {error}",notificationsGranted:"‚úÖ Notifications: permission granted.",notificationsDenied:"‚ùå Notifications: denied or not granted.",unknownError:"Unknown error",theme:"Theme",themeLight:"Light",themeDark:"Dark",themeSystem:"System",changeTheme:"Change theme",language:"Language",languageEnglish:"English",languageVietnamese:"Ti·∫øng Vi·ªát",botInfo:"Bot Information",botName:"Name:",botUsername:"Username:",botId:"Bot ID:",botDescription:"Description:",botShortDescription:"Short description:",botCommands:"Command list",botFeatures:"Supported features",noData:"‚Äî",featureThemes:"Light / dark / system theme",featurePushNotifications:"Push notifications for new messages",featureChatHistory:"Save chat history in browser",featureMemberManagement:"Member management & permissions",featureSendMessages:"Send text and media messages",preferences:"Preferences",prefAutoScroll:"Auto-scroll to new messages",prefSound:"Notification sound",prefPush:"Push notifications when tab is inactive",manageMembers:"Manage members",groupManagement:"Group Management",members:"Members",groupInfo:"Group Info",groupName:"Group name",groupDescription:"Description",groupPhoto:"Profile picture",saveChanges:"Save changes",loadingMembers:"Loading...",memberCount:"{count} members",memberInfo:"Member Information",memberName:"Name",memberUsername:"Username",memberId:"ID",memberStatus:"Status",memberJoined:"Joined",memberActions:"Member Actions",statusCreator:"Creator",statusAdministrator:"Administrator",statusModerator:"Moderator",statusMember:"Member",statusRestricted:"Restricted",statusLeft:"Left",statusKicked:"Kicked",promoteAdmin:"‚≠ê Promote to admin",promoteModerator:"üõ°Ô∏è Moderator",demoteToMember:"üë§ Member",kickUser:"üö´ Kick",copyId:"üìã Copy ID",copyUsername:"üìã Copy username",restrictUser:"üîí Restrict permissions",userActions:"User Actions",success:"‚úÖ Success",error:"‚ùå Error",warning:"‚ö†Ô∏è Warning",info:"‚ÑπÔ∏è Info",searching:"üîç Searching...",found:"‚úÖ Found",notFound:"‚ùå Not found",pleaseSelectChat:"Please select a chat first.",needToken:"You need to enter a token.",pleaseSelectConversation:"Please select a conversation.",enterChatIdOrUsername:"Please enter chat ID or username",searchingForUser:"Searching for @{username}",chatNotFound:"Chat does not exist or bot does not have access",searchError:"Error during search: {error}",idCopied:"ID copied to clipboard",usernameCopied:"Username copied to clipboard",memberKicked:"Member kicked",memberPromoted:"Member promoted",memberDemoted:"Member demoted",permissionDenied:"Permission denied",cannotDeleteMessage:"Cannot delete message (check bot permissions)",webhookActive:"Webhook is active. Delete webhook in Settings.",getUpdatesError:"getUpdates error: {error}",corsError:"CORS or network error during getUpdates",chatAction:"typing...",groupSettingsSaved:"Group settings saved",groupSettingsFailed:"Failed to save group settings: {error}",selectFile:"No file or chat selected.",fileSendFailed:"File send failed: {error}",kickConfirm:"Are you sure you want to kick {name}?",promoteConfirm:"Promote {name} to administrator?",demoteConfirm:"Demote {name} to regular member?",closeStickerPanel:"Close",noStickers:"No stickers yet. Received stickers will appear here.",errorUnknown:"Unknown error",errorNetwork:"Network error",errorPermission:"Permission error",errorNotFound:"Not found"},vi:{appTitle:"Telegram Bot",loading:"ƒêang t·∫£i...",saving:"ƒêang l∆∞u...",save:"L∆∞u",cancel:"H·ªßy",close:"ƒê√≥ng",delete:"X√≥a",refresh:"L√†m m·ªõi",search:"T√¨m ki·∫øm",ok:"OK",yes:"C√≥",no:"Kh√¥ng",you:"B·∫°n",user:"Ng∆∞·ªùi d√πng",statusDisconnected:"Ch∆∞a k·∫øt n·ªëi (thi·∫øu token)",statusConnecting:"ƒêang k·∫øt n·ªëi...",statusConnected:"ƒêang nh·∫≠n c·∫≠p nh·∫≠t...",statusError:"L·ªói: {error}",noChatSelected:"Ch∆∞a ch·ªçn cu·ªôc tr√≤ chuy·ªán",noConversations:"Ch∆∞a c√≥ cu·ªôc tr√≤ chuy·ªán. Khi c√≥ tin nh·∫Øn ƒë·∫øn, m·ª•c s·∫Ω hi·ªán ·ªü ƒë√¢y.",enterChatId:"Nh·∫≠p chat ID ho·∫∑c @username",openChat:"M·ªü chat",enterMessage:"Nh·∫≠p tin nh·∫Øn...",noConversationSelected:"Ch∆∞a ch·ªçn cu·ªôc tr√≤ chuy·ªán",send:"G·ª≠i",attach:"ƒê√≠nh k√®m",sticker:"Sticker",replyingTo:"ƒêang tr·∫£ l·ªùi:",cancelReply:"H·ªßy tr·∫£ l·ªùi",newMessage:"‚Üì Tin m·ªõi",deleteMessage:"X√≥a tin nh·∫Øn",confirmDelete:"B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tin nh·∫Øn n√†y?",messageDeleted:"ƒê√£ x√≥a tin nh·∫Øn",messageSendFailed:"G·ª≠i th·∫•t b·∫°i: {error}",networkError:"L·ªói m·∫°ng: {error}",photo:"·∫¢nh",file:"T·ªáp",unsupportedContent:"[Kh√¥ng hi·ªÉn th·ªã lo·∫°i n·ªôi dung n√†y]",animatedSticker:"[Sticker ƒë·ªông]",settingsTitle:"Trung t√¢m c√†i ƒë·∫∑t",botConnection:"K·∫øt n·ªëi bot",botToken:"Bot Token (botXXXXXXXX:YYYYYYYYYYYYYYYY)",corsProxy:"CORS proxy prefix (tu·ª≥ ch·ªçn, vd: https://cors.isomorphic-git.org/)",testConnection:"Ki·ªÉm tra",deleteWebhook:"X√≥a webhook",enableNotifications:"B·∫≠t th√¥ng b√°o",saveAndConnect:"L∆∞u & K·∫øt n·ªëi",settingsHint:"N·∫øu nh·∫≠n l·ªói 409 khi polling, h√£y x√≥a webhook. N·∫øu b·ªã CORS, th√™m proxy prefix.",enterToken:"‚ùå Nh·∫≠p Bot Token!",tokenMissing:"Ch∆∞a c√≥ token.",connectionOk:"‚úÖ OK: @{username} ‚Ä¢ id={id}",connectionNoUsername:"(kh√¥ng t√™n)",connectionFailed:"‚ùå L·ªói getMe: {error}",connectionNetworkError:"‚ùå CORS ho·∫∑c m·∫°ng l·ªói: {error}",webhookDeleted:"‚úÖ ƒê√£ x√≥a webhook.",webhookDeleteFailed:"‚ùå Kh√¥ng x√≥a ƒë∆∞·ª£c: {error}",webhookDeleteNetworkError:"‚ùå L·ªói m·∫°ng khi x√≥a webhook: {error}",notificationsGranted:"‚úÖ Th√¥ng b√°o: ƒë√£ c·∫•p quy·ªÅn.",notificationsDenied:"‚ùå Th√¥ng b√°o: b·ªã t·ª´ ch·ªëi ho·∫∑c ch∆∞a c·∫•p.",unknownError:"Kh√¥ng r√µ",theme:"Giao di·ªán",themeLight:"S√°ng",themeDark:"T·ªëi",themeSystem:"H·ªá th·ªëng",changeTheme:"ƒê·ªïi giao di·ªán",language:"Ng√¥n ng·ªØ",languageEnglish:"English",languageVietnamese:"Ti·∫øng Vi·ªát",botInfo:"Th√¥ng tin bot",botName:"T√™n:",botUsername:"Username:",botId:"Bot ID:",botDescription:"M√¥ t·∫£:",botShortDescription:"M√¥ t·∫£ ng·∫Øn:",botCommands:"Danh s√°ch l·ªánh",botFeatures:"T√≠nh nƒÉng h·ªó tr·ª£",noData:"‚Äî",featureThemes:"Giao di·ªán s√°ng / t·ªëi / h·ªá th·ªëng",featurePushNotifications:"Th√¥ng b√°o ƒë·∫©y khi c√≥ tin nh·∫Øn m·ªõi",featureChatHistory:"L∆∞u l·ªãch s·ª≠ h·ªôi tho·∫°i trong tr√¨nh duy·ªát",featureMemberManagement:"Qu·∫£n l√Ω th√†nh vi√™n & ch·ªânh s·ª≠a quy·ªÅn",featureSendMessages:"G·ª≠i tin nh·∫Øn vƒÉn b·∫£n v√† media",preferences:"T√πy ch·ªçn",prefAutoScroll:"T·ª± ƒë·ªông cu·ªôn ƒë·∫øn tin m·ªõi",prefSound:"√Çm b√°o th√¥ng b√°o",prefPush:"Th√¥ng b√°o ƒë·∫©y khi tab kh√¥ng ho·∫°t ƒë·ªông",manageMembers:"Qu·∫£n l√Ω th√†nh vi√™n",groupManagement:"Qu·∫£n l√Ω nh√≥m",members:"Th√†nh vi√™n",groupInfo:"Th√¥ng tin nh√≥m",groupName:"T√™n nh√≥m",groupDescription:"M√¥ t·∫£",groupPhoto:"·∫¢nh ƒë·∫°i di·ªán",saveChanges:"L∆∞u thay ƒë·ªïi",loadingMembers:"ƒêang t·∫£i...",memberCount:"{count} th√†nh vi√™n",memberInfo:"Th√¥ng tin th√†nh vi√™n",memberName:"T√™n",memberUsername:"Username",memberId:"ID",memberStatus:"Tr·∫°ng th√°i",memberJoined:"Tham gia",memberActions:"T√°c v·ª•",statusCreator:"Ch·ªß nh√≥m",statusAdministrator:"Qu·∫£n tr·ªã vi√™n",statusModerator:"Ng∆∞·ªùi ki·ªÉm duy·ªát",statusMember:"Th√†nh vi√™n",statusRestricted:"B·ªã h·∫°n ch·∫ø",statusLeft:"ƒê√£ r·ªùi",statusKicked:"ƒê√£ b·ªã kick",promoteAdmin:"‚≠ê ThƒÉng admin",promoteModerator:"üõ°Ô∏è Moderator",demoteToMember:"üë§ Th√†nh vi√™n",kickUser:"üö´ Kick",copyId:"üìã Copy ID",copyUsername:"üìã Copy username",restrictUser:"üîí H·∫°n ch·∫ø quy·ªÅn",userActions:"T√°c v·ª• v·ªõi ng∆∞·ªùi d√πng",success:"‚úÖ Th√†nh c√¥ng",error:"‚ùå L·ªói",warning:"‚ö†Ô∏è Ch√∫ √Ω",info:"‚ÑπÔ∏è Th√¥ng tin",searching:"üîç ƒêang t√¨m...",found:"‚úÖ T√¨m th·∫•y",notFound:"‚ùå Kh√¥ng t√¨m th·∫•y",pleaseSelectChat:"Ch·ªçn chat tr∆∞·ªõc.",needToken:"B·∫°n c·∫ßn nh·∫≠p token.",pleaseSelectConversation:"H√£y ch·ªçn cu·ªôc tr√≤ chuy·ªán.",enterChatIdOrUsername:"Vui l√≤ng nh·∫≠p chat ID ho·∫∑c username",searchingForUser:"ƒêang t√¨m @{username}",chatNotFound:"Chat kh√¥ng t·ªìn t·∫°i ho·∫∑c bot ch∆∞a c√≥ quy·ªÅn truy c·∫≠p",searchError:"L·ªói khi t√¨m ki·∫øm: {error}",idCopied:"ƒê√£ copy ID",usernameCopied:"ƒê√£ copy username",memberKicked:"ƒê√£ kick th√†nh vi√™n",memberPromoted:"ƒê√£ thƒÉng ch·ª©c",memberDemoted:"ƒê√£ h·∫° ch·ª©c",permissionDenied:"Kh√¥ng ƒë·ªß quy·ªÅn",cannotDeleteMessage:"Kh√¥ng th·ªÉ x√≥a tin nh·∫Øn (ki·ªÉm tra quy·ªÅn c·ªßa bot)",webhookActive:"Webhook ƒëang ho·∫°t ƒë·ªông. X√≥a webhook trong C√†i ƒë·∫∑t.",getUpdatesError:"L·ªói getUpdates: {error}",corsError:"CORS ho·∫∑c m·∫°ng l·ªói khi getUpdates",chatAction:"ƒëang nh·∫≠p...",groupSettingsSaved:"ƒê√£ l∆∞u c√†i ƒë·∫∑t nh√≥m",groupSettingsFailed:"Kh√¥ng th·ªÉ l∆∞u c√†i ƒë·∫∑t nh√≥m: {error}",selectFile:"Ch∆∞a ch·ªçn chat ho·∫∑c t·ªáp.",fileSendFailed:"G·ª≠i file th·∫•t b·∫°i: {error}",kickConfirm:"B·∫°n c√≥ ch·∫Øc mu·ªën kick {name}?",promoteConfirm:"ThƒÉng {name} l√™n qu·∫£n tr·ªã vi√™n?",demoteConfirm:"H·∫° {name} xu·ªëng th√†nh vi√™n th∆∞·ªùng?",closeStickerPanel:"ƒê√≥ng",noStickers:"Ch∆∞a c√≥ sticker. Sticker nh·∫≠n ƒë∆∞·ª£c s·∫Ω hi·ªán ·ªü ƒë√¢y.",errorUnknown:"L·ªói kh√¥ng x√°c ƒë·ªãnh",errorNetwork:"L·ªói m·∫°ng",errorPermission:"L·ªói quy·ªÅn",errorNotFound:"Kh√¥ng t√¨m th·∫•y"}},st="tg_language",Y="en",it=["en","vi"];let P=Y;function an(){return(navigator.language||navigator.userLanguage||"").toLowerCase().startsWith("vi")?"vi":"en"}function cn(){const e=localStorage.getItem(st);return e&&it.includes(e)?e:an()}function ln(){return P=cn(),at(P),P}function dn(){return P}function mn(e){return it.includes(e)||(console.warn(`Language ${e} not supported, falling back to ${Y}`),e=Y),P=e,at(e),e}function at(e){try{localStorage.setItem(st,e)}catch(t){console.warn("Failed to save language preference:",t)}}function a(e,t={}){let r=(ie[P]||ie[Y])[e]||ie[Y][e]||e;return Object.keys(t).forEach(s=>{const i=`{${s}}`;r=r.replace(new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),t[s])}),r}function X(e,t,n,r={}){const s=e.side==="right",i=s||r.canDeleteOthers,l=document.createElement("div");if(l.className="message "+(s?"right":"left")+(e.reply_to?" reply":""),l.dataset.msgId=e.id,i){const d=document.createElement("div");d.className="msg-actions";const h=document.createElement("button");h.className="msg-action-btn",h.textContent="üóëÔ∏è",h.title=a("deleteMessage"),h.addEventListener("click",m=>{m.stopPropagation(),n&&n(e.id)}),d.appendChild(h),l.appendChild(d)}if(e.reply_preview){const d=document.createElement("div");d.className="reply-to",d.textContent="‚Ü™ "+e.reply_preview,l.appendChild(d)}const c=document.createElement("div");if(e.type==="photo"){const d=document.createElement("img");if(d.src=e.mediaUrl,d.className="media",d.alt=e.caption||a("photo"),c.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",c.appendChild(h)}}else if(e.type==="video"){const d=document.createElement("video");if(d.src=e.mediaUrl,d.controls=!0,d.playsInline=!0,d.className="media",c.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",c.appendChild(h)}}else if(e.type==="audio"||e.type==="voice"){const d=document.createElement("audio");if(d.src=e.mediaUrl,d.controls=!0,d.className="media",c.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",c.appendChild(h)}}else if(e.type==="document"){const d=document.createElement("a");if(d.href=e.mediaUrl,d.target="_blank",d.rel="noopener noreferrer",d.className="doc-link",d.textContent=e.fileName||a("file"),c.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",c.appendChild(h)}}else e.type==="sticker"?un(c,e):c.textContent=e.text;l.appendChild(c);const u=document.createElement("div");u.className="meta";const p=document.createElement("span");p.className="sender-name",p.textContent=e.fromName,r.isGroupChat&&r.onUserClick&&(p.style.cursor="pointer",p.style.textDecoration="underline",p.addEventListener("click",d=>{d.stopPropagation(),r.onUserClick(e.fromId,e.fromName,e.fromUsername)})),u.appendChild(p),u.appendChild(document.createTextNode(` ‚Ä¢ ${Ut(e.date)}`)),l.appendChild(u),t.appendChild(l)}function un(e,t){if(t.stickerFormat==="webp"||t.stickerFormat==="static"){const n=document.createElement("img");n.src=t.mediaUrl,n.className="media sticker-image",n.alt=t.emoji||"Sticker",n.style.maxWidth="200px",n.style.maxHeight="200px",n.style.objectFit="contain",e.appendChild(n)}else if(t.stickerFormat==="webm"||t.stickerFormat==="video"){const n=document.createElement("video");n.src=t.mediaUrl,n.autoplay=!0,n.loop=!0,n.muted=!0,n.playsInline=!0,n.className="media sticker-video",n.style.maxWidth="200px",n.style.maxHeight="200px",n.style.objectFit="contain",e.appendChild(n)}else if(t.stickerFormat==="tgs"||t.stickerFormat==="animated"){const n=document.createElement("div");n.className="sticker-placeholder",n.style.fontSize="3rem",n.style.textAlign="center",n.style.padding="10px",n.textContent=t.emoji||"‚ú®",e.appendChild(n);const r=document.createElement("div");r.className="sticker-note",r.style.fontSize="0.75rem",r.style.color="var(--muted)",r.style.marginTop="4px",r.style.textAlign="center",r.textContent=a("animatedSticker"),e.appendChild(r)}else{const n=document.createElement("div");n.textContent="[Sticker] "+(t.emoji||""),e.appendChild(n)}}function N(e,t,n,r,s,i){r.innerHTML="";const l=Array.from(e.values()).sort((c,u)=>(u.lastDate||0)-(c.lastDate||0));if(!l.length){n&&(r.appendChild(n),n.style.display="block");return}n&&(n.style.display="none");for(const c of l){const u=document.createElement("div");u.className="chat-item"+(c.id===t?" active":""),u.dataset.chatId=c.id,u.innerHTML=`
      <div class="avatar">${c.avatarText}</div>
      <div class="info">
        <div class="name">${c.title}</div>
        <div class="last">${c.lastText?oe(c.lastText):"‚Äî"}</div>
      </div>
      <div class="badge${c.unread?"":" hidden"}">${c.unread||""}</div>
      <button class="delete-chat-btn" title="X√≥a chat">üóëÔ∏è</button>
    `,u.querySelector(".info, .avatar").addEventListener("click",()=>s(c.id)),u.querySelector(".delete-chat-btn").addEventListener("click",p=>{p.stopPropagation(),i&&confirm(`X√≥a chat "${c.title}"?`)&&i(c.id)}),r.appendChild(u)}}function de(e,t,n,r={}){if(t.innerHTML="",!(!e||!e.messages))for(const s of e.messages)X(s,t,n,r)}function hn(e){e&&(e.innerHTML="")}function ee(e,t,n){t&&(t.textContent=(e==null?void 0:e.title)||"Ch∆∞a ch·ªçn cu·ªôc tr√≤ chuy·ªán"),n&&(e?(n.textContent=e.avatarText||"?",n.style.display="grid"):n.style.display="none")}function ct(e,t){t&&(e&&(e.type==="group"||e.type==="supergroup")?t.style.display="block":t.style.display="none")}function Ce(e,t){if(!e||!t)return;t.scrollTop+t.clientHeight>=t.scrollHeight-20||(e.style.display="block")}function pn(e,t,n){if(t){if(t.innerHTML="",!e||e.length===0){const r=document.createElement("div");r.className="stickers-empty",r.textContent="Ch∆∞a c√≥ sticker n√†o",t.appendChild(r);return}e.forEach(r=>{const s=document.createElement("div");if(s.className="sticker-item",s.title=r.emoji||"Sticker",r.file_id&&r.url)if(r.is_animated)s.innerHTML=`<div class="sticker-thumb">${r.emoji||"‚ú®"}</div>`;else if(r.is_video){const i=document.createElement("video");i.src=r.url,i.autoplay=!0,i.loop=!0,i.muted=!0,i.playsInline=!0,i.className="sticker-thumb",s.appendChild(i)}else{const i=document.createElement("img");i.src=r.url,i.alt=r.emoji||"Sticker",i.className="sticker-thumb",s.appendChild(i)}else s.innerHTML=`<div class="sticker-thumb">${r.emoji||"‚ùì"}</div>`;s.addEventListener("click",()=>{n&&n(r)}),t.appendChild(s)})}}const fn=()=>document.getElementById("chatList"),gn=()=>document.getElementById("emptyNotice"),yn=()=>document.getElementById("messages"),En=()=>document.getElementById("newMsgBtn"),bn=()=>document.getElementById("input"),kn=()=>document.getElementById("sendBtn"),vn=()=>document.getElementById("attachBtn"),Cn=()=>document.getElementById("stickerBtn"),_n=()=>document.getElementById("fileInput"),Bn=()=>document.getElementById("replyContext"),In=()=>document.getElementById("replyText"),Mn=()=>document.getElementById("cancelReply"),wn=()=>document.getElementById("stickerPanel"),Sn=()=>document.getElementById("closeStickerBtn"),Tn=()=>document.getElementById("stickerList"),Ln=()=>document.getElementById("userActionsMenu"),xn=()=>document.getElementById("userActionsTitle"),Dn=()=>document.getElementById("closeUserActionsBtn"),Nn=()=>document.getElementById("copyIdBtn"),Un=()=>document.getElementById("copyUsernameBtn"),An=()=>document.getElementById("kickUserBtn"),Pn=()=>document.getElementById("promoteUserBtn"),On=()=>document.getElementById("moderateUserBtn"),Fn=()=>document.getElementById("demoteUserBtn"),Rn=()=>document.getElementById("restrictUserBtn"),$n=()=>document.getElementById("status"),Hn=()=>document.getElementById("botInfo"),Kn=()=>document.getElementById("headerTitle"),jn=()=>document.getElementById("activeAvatar"),Yn=()=>document.getElementById("themeToggleBtn"),Gn=()=>document.getElementById("sidebar"),Wn=()=>document.getElementById("menuToggle"),Xn=()=>document.getElementById("openChatInput"),qn=()=>document.getElementById("openChatBtn"),Vn=()=>document.getElementById("membersBtn"),Jn=()=>document.getElementById("membersOverlay"),zn=()=>document.getElementById("membersList"),Qn=()=>document.getElementById("closeMembersBtn"),Zn=()=>document.getElementById("groupInfo"),eo=()=>document.getElementById("membersHint"),to=()=>document.getElementById("overlay"),no=()=>document.getElementById("settingsBtn"),oo=()=>document.getElementById("saveBtn"),ro=()=>document.getElementById("cancelBtn"),so=()=>document.getElementById("tokenInput"),io=()=>document.getElementById("proxyInput"),ao=()=>document.getElementById("testBtn"),co=()=>document.getElementById("deleteWebhookBtn"),lo=()=>document.getElementById("settingsHint"),mo=()=>document.getElementById("notifBtn"),uo=()=>document.getElementById("themeOptionLight"),ho=()=>document.getElementById("themeOptionDark"),po=()=>document.getElementById("themeOptionSystem"),fo=()=>document.getElementById("langOptionEn"),go=()=>document.getElementById("langOptionVi"),yo=()=>document.getElementById("botDetailName"),Eo=()=>document.getElementById("botDetailUsername"),bo=()=>document.getElementById("botDetailId"),ko=()=>document.getElementById("botDetailDescription"),vo=()=>document.getElementById("botDetailShortDescription"),Co=()=>document.getElementById("botCommandsList"),_o=()=>document.getElementById("botFeatureList"),Bo=()=>document.getElementById("prefAutoScroll"),Io=()=>document.getElementById("prefSound"),Mo=()=>document.getElementById("prefPush"),wo=()=>document.getElementById("membersTabBtn"),So=()=>document.getElementById("groupTabBtn"),To=()=>document.getElementById("membersTab"),Lo=()=>document.getElementById("groupSettingsTab"),xo=()=>document.getElementById("refreshMembersBtn"),Do=()=>document.getElementById("groupNameInput"),No=()=>document.getElementById("groupDescriptionInput"),Uo=()=>document.getElementById("groupPhotoInput"),Ao=()=>document.getElementById("saveGroupBtn"),Po=()=>document.getElementById("memberModal"),Oo=()=>document.getElementById("memberModalAvatar"),Fo=()=>document.getElementById("memberModalName"),Ro=()=>document.getElementById("memberModalUsername"),$o=()=>document.getElementById("memberModalId"),Ho=()=>document.getElementById("memberModalStatus"),Ko=()=>document.getElementById("memberModalJoined"),jo=()=>document.getElementById("memberPromoteBtn"),Yo=()=>document.getElementById("memberModeratorBtn"),Go=()=>document.getElementById("memberDemoteBtn"),Wo=()=>document.getElementById("memberKickBtn"),Xo=()=>document.getElementById("closeMemberModalBtn"),qo=()=>document.getElementById("toasts");function Vo(){return{chatListEl:fn(),emptyNoticeEl:gn(),messagesEl:yn(),newMsgBtn:En(),inputEl:bn(),sendBtn:kn(),attachBtn:vn(),fileInputEl:_n(),replyContext:Bn(),replyText:In(),cancelReply:Mn(),statusEl:$n(),botInfoEl:Hn(),headerTitleEl:Kn(),activeAvatarEl:jn(),themeToggleBtn:Yn(),sidebarEl:Gn(),menuToggleEl:Wn(),openChatInputEl:Xn(),openChatBtnEl:qn(),membersBtnEl:Vn(),membersOverlayEl:Jn(),membersListEl:zn(),closeMembersBtn:Qn(),groupInfoEl:Zn(),membersHintEl:eo(),membersTabBtn:wo(),groupTabBtn:So(),membersTabPanel:To(),groupSettingsTab:Lo(),refreshMembersBtn:xo(),groupNameInputEl:Do(),groupDescriptionInputEl:No(),groupPhotoInputEl:Uo(),saveGroupBtn:Ao(),memberModalEl:Po(),memberModalAvatarEl:Oo(),memberModalNameEl:Fo(),memberModalUsernameEl:Ro(),memberModalIdEl:$o(),memberModalStatusEl:Ho(),memberModalJoinedEl:Ko(),memberPromoteBtn:jo(),memberModeratorBtn:Yo(),memberDemoteBtn:Go(),memberKickBtn:Wo(),closeMemberModalBtn:Xo(),overlayEl:to(),settingsBtn:no(),saveBtn:oo(),cancelBtn:ro(),tokenInputEl:so(),proxyInputEl:io(),testBtn:ao(),deleteWebhookBtn:co(),settingsHintEl:lo(),notifBtn:mo(),themeOptionLight:uo(),themeOptionDark:ho(),themeOptionSystem:po(),langOptionEn:fo(),langOptionVi:go(),botDetailNameEl:yo(),botDetailUsernameEl:Eo(),botDetailIdEl:bo(),botDetailDescriptionEl:ko(),botDetailShortDescriptionEl:vo(),botCommandsListEl:Co(),botFeatureListEl:_o(),prefAutoScrollEl:Bo(),prefSoundEl:Io(),prefPushEl:Mo(),toastsEl:qo(),stickerBtn:Cn(),stickerPanel:wn(),closeStickerBtn:Sn(),stickerList:Tn(),userActionsMenu:Ln(),userActionsTitle:xn(),closeUserActionsBtn:Dn(),copyIdBtn:Nn(),copyUsernameBtn:Un(),kickUserBtn:An(),promoteUserBtn:Pn(),moderateUserBtn:On(),demoteUserBtn:Fn(),restrictUserBtn:Rn()}}let V=null,ae=null,U=[],j=null,Pe=50;function _e(){return typeof window<"u"&&"Notification"in window}async function Be(){return"serviceWorker"in navigator?V||(ae||(ae=navigator.serviceWorker.register("/sw.js").then(e=>(V=e,e)).catch(e=>(console.warn("Service worker registration failed:",e),V=null,null))),ae):null}function g(e,t,n,r={}){if(!n)return;const s={id:Date.now(),title:e,body:t,timestamp:new Date,chatId:r.chatId,messageId:r.messageId};U.unshift(s),U.length>Pe&&(U=U.slice(0,Pe)),j&&j.remove();const i=document.createElement("div");i.className="toast compact",j=i;const l=document.createElement("div");l.className="toast-content";const c=document.createElement("div");c.className="toast-title",c.textContent=e;const u=document.createElement("div");u.className="toast-body",u.textContent=t,l.appendChild(c),l.appendChild(u),i.appendChild(l);const p=document.createElement("button");p.className="toast-history-btn",p.textContent="üìã",p.title="Xem l·ªãch s·ª≠ th√¥ng b√°o",p.addEventListener("click",d=>{d.stopPropagation(),Zo(n)}),i.appendChild(p),r.chatId&&(i.style.cursor="pointer",i.addEventListener("click",()=>{r.scrollToMessage&&typeof r.scrollToMessage=="function"&&r.scrollToMessage(r.chatId,r.messageId)})),n.appendChild(i),setTimeout(()=>{j===i&&(i.remove(),j=null)},4e3)}async function Jo(e,t,n,r={}){var i;const s=e.lastText||oe(t.text||t.caption||"["+(t.type||"tin nh·∫Øn")+"]");if(g(e.title,s,n,{chatId:e.id,messageId:t.id,scrollToMessage:r.scrollToMessage}),r.playSound!==!1&&Ot(),!!_e()&&r.push!==!1&&document.hidden&&Notification.permission==="granted")try{const l={body:s,tag:`chat-${e.id}`,data:{chatId:e.id,messageId:t.id,url:((i=window==null?void 0:window.location)==null?void 0:i.href)||""}},c=await Be();c&&c.showNotification?c.showNotification(e.title,l):new Notification(e.title,l)}catch(l){console.warn("Kh√¥ng th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o ƒë·∫©y:",l)}}async function zo(){if(!_e())throw new Error("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Notifications");const e=await Notification.requestPermission();return e==="granted"&&await Be(),e}async function Qo(){return _e()?Be():null}function Zo(e){if(!e)return;const t=document.getElementById("notificationHistoryModal");t&&t.remove();const n=document.createElement("div");n.id="notificationHistoryModal",n.className="overlay",n.innerHTML=`
    <div class="dialog dialog-large">
      <div class="dialog-header">
        <h3>L·ªãch s·ª≠ th√¥ng b√°o</h3>
        <button class="icon-btn close-history" title="ƒê√≥ng">‚úï</button>
      </div>
      <div class="notification-history">
        ${U.length===0?'<p class="empty-history">Ch∆∞a c√≥ th√¥ng b√°o n√†o</p>':""}
        ${U.map(r=>`
          <div class="history-item ${r.chatId?"clickable":""}" data-chat-id="${r.chatId||""}" data-message-id="${r.messageId||""}">
            <div class="history-header">
              <div class="history-title">${r.title}</div>
              <div class="history-time">${er(r.timestamp)}</div>
            </div>
            <div class="history-body">${r.body}</div>
          </div>
        `).join("")}
      </div>
    </div>
  `,n.querySelector(".close-history").addEventListener("click",()=>n.remove()),n.addEventListener("click",r=>{r.target===n&&n.remove()}),n.querySelectorAll(".history-item.clickable").forEach(r=>{r.addEventListener("click",()=>{const s=r.dataset.chatId,i=r.dataset.messageId;s&&typeof window.scrollToMessage=="function"&&(window.scrollToMessage(s,i),n.remove())})}),document.body.appendChild(n)}function er(e){const n=new Date-e,r=Math.floor(n/6e4),s=Math.floor(n/36e5),i=Math.floor(n/864e5);return r<1?"V·ª´a xong":r<60?`${r} ph√∫t tr∆∞·ªõc`:s<24?`${s} gi·ªù tr∆∞·ªõc`:i<7?`${i} ng√†y tr∆∞·ªõc`:e.toLocaleDateString("vi-VN")}const tr={can_manage_chat:!0,can_delete_messages:!0,can_manage_video_chats:!0,can_restrict_members:!0,can_promote_members:!0,can_change_info:!0,can_invite_users:!0,can_pin_messages:!0,is_anonymous:!1},nr={can_manage_chat:!0,can_delete_messages:!0,can_manage_video_chats:!0,can_restrict_members:!0,can_promote_members:!1,can_change_info:!0,can_invite_users:!0,can_pin_messages:!0,is_anonymous:!1},or={can_manage_chat:!1,can_delete_messages:!1,can_manage_video_chats:!1,can_restrict_members:!1,can_promote_members:!1,can_change_info:!1,can_invite_users:!0,can_pin_messages:!1,is_anonymous:!1},rr={can_send_messages:!0,can_send_audios:!0,can_send_documents:!0,can_send_photos:!0,can_send_videos:!0,can_send_video_notes:!0,can_send_voice_notes:!0,can_send_polls:!0,can_send_other_messages:!0,can_add_web_page_previews:!0,can_change_info:!1,can_invite_users:!0,can_pin_messages:!1,can_manage_topics:!1};async function ce(e,t,n){const r=(n||"").toLowerCase();if(r==="admin"||r==="administrator")return se(e,t,tr);if(r==="moderator")return se(e,t,nr);if(r==="member")return await se(e,t,or),St(e,t,rr);throw new Error("Vai tr√≤ kh√¥ng h·ª£p l·ªá: "+n)}async function sr(e,t,n){return wt(e,t)}let o=null,ir=null,me=null,J=!1;const te={autoScroll:!0,sound:!0,push:!0};let C={...te},G="system",T=null;function ar(){o=Vo(),ln(),ft(),T=window.matchMedia("(prefers-color-scheme: dark)"),T.addEventListener?T.addEventListener("change",Oe):T.addListener&&T.addListener(Oe);const e=rn();O(e||"system",!1),C=pr(),dt(),Qo().catch(()=>{}),nn();const t=localStorage.getItem("bot_token"),n=localStorage.getItem("cors_proxy")||"";if(t){Je(t),Ke(t),je(n);const r=Jt(t);Rt(r);const s=Zt();Qe(s);const i=Qt(t);i&&(Ze(i),yt()),gt()}else o.overlayEl.classList.remove("hidden");cr(),Ie()}function cr(){var e,t,n,r,s,i,l,c,u,p,d,h,m,k,I,q,Te,Le,xe,De,Ne,Ue;o.settingsBtn.addEventListener("click",lr),o.saveBtn.addEventListener("click",dr),o.cancelBtn.addEventListener("click",lt),o.testBtn.addEventListener("click",mr),o.deleteWebhookBtn.addEventListener("click",ur),o.notifBtn.addEventListener("click",hr),(e=o.themeToggleBtn)==null||e.addEventListener("click",gr),(t=o.themeOptionLight)==null||t.addEventListener("click",()=>O("light")),(n=o.themeOptionDark)==null||n.addEventListener("click",()=>O("dark")),(r=o.themeOptionSystem)==null||r.addEventListener("click",()=>O("system")),(s=o.langOptionEn)==null||s.addEventListener("click",()=>Fe("en")),(i=o.langOptionVi)==null||i.addEventListener("click",()=>Fe("vi")),(l=o.prefAutoScrollEl)==null||l.addEventListener("change",y=>z("autoScroll",y.target.checked)),(c=o.prefSoundEl)==null||c.addEventListener("change",y=>z("sound",y.target.checked)),(u=o.prefPushEl)==null||u.addEventListener("change",y=>z("push",y.target.checked)),(p=o.openChatBtnEl)==null||p.addEventListener("click",$e),(d=o.openChatInputEl)==null||d.addEventListener("keydown",y=>{y.key==="Enter"&&$e()}),o.menuToggleEl.addEventListener("click",()=>{o.sidebarEl.classList.toggle("hidden-mobile")}),o.messagesEl.addEventListener("click",Cr),o.newMsgBtn.addEventListener("click",()=>{R(o.messagesEl),o.newMsgBtn.style.display="none"}),o.sendBtn.addEventListener("click",Re),o.inputEl.addEventListener("keydown",y=>{y.key==="Enter"&&Re()}),o.inputEl.addEventListener("focus",Ir),o.inputEl.addEventListener("blur",ne),o.stickerBtn.addEventListener("click",wr),o.closeStickerBtn.addEventListener("click",Se),o.closeUserActionsBtn.addEventListener("click",Q),o.copyIdBtn.addEventListener("click",()=>S("copyId")),o.copyUsernameBtn.addEventListener("click",()=>S("copyUsername")),o.kickUserBtn.addEventListener("click",()=>S("kick")),o.promoteUserBtn.addEventListener("click",()=>S("promote")),o.moderateUserBtn.addEventListener("click",()=>S("moderate")),o.demoteUserBtn.addEventListener("click",()=>S("demote")),o.restrictUserBtn.addEventListener("click",()=>S("restrict")),document.addEventListener("click",y=>{if(o.userActionsMenu&&!o.userActionsMenu.classList.contains("hidden")){const bt=o.userActionsMenu.contains(y.target),kt=y.target.classList.contains("sender-name");!bt&&!kt&&Q()}}),document.addEventListener("keydown",y=>{(y.key==="Escape"||y.key==="Esc")&&o.userActionsMenu&&!o.userActionsMenu.classList.contains("hidden")&&Q()}),o.attachBtn.addEventListener("click",()=>{if(!f){alert(a("pleaseSelectChat"));return}ne(),o.fileInputEl.value="",o.fileInputEl.accept="*/*",o.fileInputEl.click()}),o.fileInputEl.addEventListener("change",()=>{const y=o.fileInputEl.files[0];y&&Br(y)}),o.cancelReply.addEventListener("click",Me),o.membersBtnEl.addEventListener("click",openMembersDialog),o.closeMembersBtn.addEventListener("click",closeMembersDialog),o.membersOverlayEl.addEventListener("click",y=>{y.target===o.membersOverlayEl&&closeMembersDialog()}),(h=o.membersTabBtn)==null||h.addEventListener("click",()=>switchMembersTab("members")),(m=o.groupTabBtn)==null||m.addEventListener("click",()=>switchMembersTab("group")),(k=o.refreshMembersBtn)==null||k.addEventListener("click",()=>refreshMembersList(!0)),(I=o.saveGroupBtn)==null||I.addEventListener("click",saveGroupInfo),(q=o.membersListEl)==null||q.addEventListener("click",handleMemberListClick),(Te=o.closeMemberModalBtn)==null||Te.addEventListener("click",closeMemberModal),(Le=o.memberModalEl)==null||Le.addEventListener("click",y=>{y.target===o.memberModalEl&&closeMemberModal()}),(xe=o.memberPromoteBtn)==null||xe.addEventListener("click",()=>changeMemberRole("admin")),(De=o.memberModeratorBtn)==null||De.addEventListener("click",()=>changeMemberRole("moderator")),(Ne=o.memberDemoteBtn)==null||Ne.addEventListener("click",()=>changeMemberRole("member")),(Ue=o.memberKickBtn)==null||Ue.addEventListener("click",kickMemberFromModal)}function Ie(){const e=_(f);if(N(b,f,o.emptyNoticeEl,o.chatListEl,w),e){ee(e,o.headerTitleEl,o.activeAvatarEl),ct(e,o.membersBtnEl);const t=L(e.id);de(e,o.messagesEl,K,{canDeleteOthers:t.canDeleteMessages,isGroupChat:e.type==="group"||e.type==="supergroup",onUserClick:we}),C.autoScroll&&R(o.messagesEl)}else ee(null,o.headerTitleEl,o.activeAvatarEl),de(null,o.messagesEl)}function w(e){ze(e);const t=_(e);t?(t.unread=0,o.inputEl.disabled=!1,o.sendBtn.disabled=!1,o.attachBtn.disabled=!1,o.inputEl.placeholder=a("enterMessage"),o.inputEl.focus(),window.innerWidth<=768&&o.sidebarEl.classList.add("hidden-mobile")):(o.inputEl.disabled=!0,o.sendBtn.disabled=!0,o.attachBtn.disabled=!0,o.inputEl.placeholder=a("noConversationSelected")),o.newMsgBtn.style.display="none",Ie(),vr(e).catch(()=>{})}function lr(){o.tokenInputEl.value=E,o.proxyInputEl.value=localStorage.getItem("cors_proxy")||"",o.overlayEl.classList.remove("hidden")}function lt(){o.overlayEl.classList.add("hidden")}function dr(){const e=o.tokenInputEl.value.trim(),t=o.proxyInputEl.value.trim();if(!e){o.settingsHintEl.textContent=a("enterToken");return}e!==E&&(tn(E),Yt()),Je(e),Ke(e),je(t),localStorage.setItem("bot_token",e),t&&localStorage.setItem("cors_proxy",t),lt(),gt()}async function mr(){if(!E){o.settingsHintEl.textContent=a("tokenMissing");return}try{const e=await Xe();e.ok?o.settingsHintEl.textContent=a("connectionOk",{username:e.result.username||a("connectionNoUsername"),id:e.result.id}):o.settingsHintEl.textContent=a("connectionFailed",{error:e.description||a("unknownError")})}catch(e){o.settingsHintEl.textContent=a("connectionNetworkError",{error:e.message})}}async function ur(){if(E)try{const e=await Lt(!1);o.settingsHintEl.textContent=e.ok?a("webhookDeleted"):a("webhookDeleteFailed",{error:e.description||a("unknownError")})}catch(e){o.settingsHintEl.textContent=a("webhookDeleteNetworkError",{error:e.message})}}async function hr(){try{const t=await zo()==="granted";o.settingsHintEl.textContent=a(t?"notificationsGranted":"notificationsDenied"),z("push",t)}catch(e){o.settingsHintEl.textContent=a("error")+": "+e.message}}function z(e,t,n=!0){e in te&&(C={...C,[e]:t},n&&fr(),dt())}function pr(){try{const e=JSON.parse(localStorage.getItem("ui_preferences")||"{}");return{...te,...e}}catch{return{...te}}}function fr(){try{localStorage.setItem("ui_preferences",JSON.stringify(C))}catch(e){console.warn("Kh√¥ng th·ªÉ l∆∞u tu·ª≥ ch·ªçn UI:",e)}}function dt(){o.prefAutoScrollEl&&(o.prefAutoScrollEl.checked=!!C.autoScroll),o.prefSoundEl&&(o.prefSoundEl.checked=!!C.sound),o.prefPushEl&&(o.prefPushEl.checked=!!C.push)}function mt(e){return e==="system"?T&&T.matches?"dark":"light":e}function O(e,t=!0){G=e,t&&on(e);const n=mt(e);document.body.dataset.theme=n,document.body.dataset.themePreference=e,ut(e),ht(n)}function ut(e){const t={light:o.themeOptionLight,dark:o.themeOptionDark,system:o.themeOptionSystem};Object.entries(t).forEach(([n,r])=>{r&&(n===e?r.classList.add("active"):r.classList.remove("active"))})}function ht(e){o.themeToggleBtn&&(o.themeToggleBtn.textContent=e==="dark"?"üåô":"üåû")}function gr(){const e=["light","dark","system"],t=e.indexOf(G),n=e[(t+1)%e.length];O(n)}function Oe(){G==="system"&&O("system",!1)}function Fe(e){mn(e),ft(),pt(e),Ie()}function pt(e){const t={en:o.langOptionEn,vi:o.langOptionVi};Object.entries(t).forEach(([n,r])=>{r&&(n===e?r.classList.add("active"):r.classList.remove("active"))})}function ft(){document.querySelectorAll("[data-i18n]").forEach(t=>{const n=t.getAttribute("data-i18n");n&&(t.textContent=a(n))}),o.openChatInputEl&&(o.openChatInputEl.placeholder=a("enterChatId")),o.inputEl&&(f?o.inputEl.placeholder=a("enterMessage"):o.inputEl.placeholder=a("noConversationSelected")),o.tokenInputEl&&(o.tokenInputEl.placeholder=a("botToken")),o.proxyInputEl&&(o.proxyInputEl.placeholder=a("corsProxy")),o.settingsBtn&&(o.settingsBtn.title=a("settingsTitle"),o.settingsBtn.setAttribute("aria-label",a("settingsTitle"))),o.themeToggleBtn&&(o.themeToggleBtn.title=a("changeTheme"),o.themeToggleBtn.setAttribute("aria-label",a("changeTheme"))),o.openChatBtnEl&&(o.openChatBtnEl.title=a("openChat"),o.openChatBtnEl.setAttribute("aria-label",a("openChat"))),o.sendBtn&&(o.sendBtn.title=a("send"),o.sendBtn.setAttribute("aria-label",a("send"))),o.attachBtn&&(o.attachBtn.title=a("attach"),o.attachBtn.setAttribute("aria-label",a("attach"))),o.stickerBtn&&(o.stickerBtn.title=a("sticker"),o.stickerBtn.setAttribute("aria-label",a("sticker"))),o.membersBtnEl&&(o.membersBtnEl.title=a("manageMembers"),o.membersBtnEl.setAttribute("aria-label",a("manageMembers"))),o.cancelReply&&o.cancelReply.setAttribute("aria-label",a("cancelReply")),pt(dn())}function yr(){return[a("featureThemes"),a("featurePushNotifications"),a("featureChatHistory"),a("featureMemberManagement"),a("featureSendMessages")]}async function gt(){var e,t,n,r,s;if(!E){o.statusEl.textContent=a("statusDisconnected");return}o.statusEl.textContent=a("statusConnecting");try{const i=await Xe();if(i.ok){const[l,c,u]=await Promise.allSettled([xt(),Dt(),Nt()]),p=l.status==="fulfilled"&&((e=l.value)!=null&&e.ok)?l.value.result||[]:[],d=c.status==="fulfilled"&&((t=c.value)!=null&&t.ok)&&((n=c.value.result)==null?void 0:n.description)||null,h=u.status==="fulfilled"&&((r=u.value)!=null&&r.ok)&&((s=u.value.result)==null?void 0:s.short_description)||null,m={id:i.result.id,username:i.result.username||null,name:[i.result.first_name,i.result.last_name].filter(Boolean).join(" ")||i.result.username||"Bot",commands:p,description:d,shortDescription:h};Ze(m),zt(E,m),yt(),Er()}else o.statusEl.textContent="L·ªói getMe: "+(i.description||"Kh√¥ng r√µ")}catch{o.statusEl.textContent="CORS ho·∫∑c m·∫°ng l·ªói khi getMe"}}function yt(){const e=M;if(e.username?o.botInfoEl.textContent="@"+e.username:e.id?o.botInfoEl.textContent="Bot ID: "+e.id:o.botInfoEl.textContent="",o.botDetailNameEl&&(o.botDetailNameEl.textContent=e.name||"‚Äî"),o.botDetailUsernameEl&&(o.botDetailUsernameEl.textContent=e.username?"@"+e.username:"‚Äî"),o.botDetailIdEl&&(o.botDetailIdEl.textContent=e.id||"‚Äî"),o.botDetailDescriptionEl&&(o.botDetailDescriptionEl.textContent=e.description||"‚Äî"),o.botDetailShortDescriptionEl&&(o.botDetailShortDescriptionEl.textContent=e.shortDescription||"‚Äî"),o.botCommandsListEl)if(o.botCommandsListEl.innerHTML="",Array.isArray(e.commands)&&e.commands.length)e.commands.forEach(t=>{const n=document.createElement("li");n.textContent=`/${t.command}${t.description?" ‚Äî "+t.description:""}`,o.botCommandsListEl.appendChild(n)});else{const t=document.createElement("li");t.textContent="Kh√¥ng c√≥ l·ªánh m·∫∑c ƒë·ªãnh",o.botCommandsListEl.appendChild(t)}o.botFeatureListEl&&(o.botFeatureListEl.innerHTML="",yr().forEach(t=>{const n=document.createElement("li");n.textContent=t,o.botFeatureListEl.appendChild(n)})),ut(G),ht(mt(G))}function Er(){clearInterval(ir),J=!0,ue(),o.statusEl.textContent="ƒêang nh·∫≠n c·∫≠p nh·∫≠t..."}async function ue(){if(J)try{await br(),setTimeout(()=>{J&&ue()},1e3)}catch(e){console.error("Polling error:",e),setTimeout(()=>{J&&ue()},2e3)}}async function br(){try{const e=await Ct(ye||void 0);if(!e.ok){o.statusEl.textContent=a("getUpdatesError",{error:e.description||a("unknownError")}),String(e.error_code)==="409"&&(o.statusEl.textContent=a("webhookActive"));return}for(const t of e.result||[]){Qe(t.update_id+1),en(t.update_id+1);const n=t.message||t.edited_message||t.channel_post||t.edited_channel_post;!n||!n.chat||await kr(n)}o.statusEl.textContent=a("statusConnected")}catch(e){throw o.statusEl.textContent=a("corsError"),e}}async function kr(e){const t=e.chat,n=String(t.id),s=t.type==="private"?[t.first_name,t.last_name].filter(Boolean).join(" ")||t.username||a("user"):t.title||t.type||"Chat",i=$(n,{type:t.type,title:s,avatarText:F(s)});t.title&&t.title!==i.title&&(i.title=t.title,i.avatarText=F(t.title),f===n&&ee(i,o.headerTitleEl,o.activeAvatarEl)),t.type&&t.type!==i.type&&(i.type=t.type);const l=(e.date||Math.floor(Date.now()/1e3))*1e3;e.from&&Ae(n,{id:e.from.id,first_name:e.from.first_name,last_name:e.from.last_name,username:e.from.username,isBot:e.from.is_bot,status:e.from.is_bot?"bot":"member",lastSeen:l}),Array.isArray(e.new_chat_members)&&e.new_chat_members.length&&e.new_chat_members.forEach(m=>{Ae(n,{id:m.id,first_name:m.first_name,last_name:m.last_name,username:m.username,isBot:m.is_bot,status:m.is_bot?"bot":"member",joinedDate:l,lastSeen:l})}),e.left_chat_member&&Gt(n,e.left_chat_member.id);const c=f===n,u=c?ge(o.messagesEl):!1,p=e.from&&M.id&&e.from.id===M.id,d={id:e.message_id,side:p?"right":"left",date:l,fromId:e.from?e.from.id:null,fromName:At(e),fromUsername:Pt(e),reply_to:e.reply_to_message&&e.reply_to_message.message_id,reply_preview:e.reply_to_message&&oe(e.reply_to_message.text||e.reply_to_message.caption||"")};let h;if(e.text)h={...d,type:"text",text:e.text};else if(e.photo){const m=e.photo[e.photo.length-1],k=await B(m.file_id);h={...d,type:"photo",mediaUrl:k,caption:e.caption||""}}else if(e.video){const m=await B(e.video.file_id);h={...d,type:"video",mediaUrl:m,caption:e.caption||""}}else if(e.audio){const m=await B(e.audio.file_id);h={...d,type:"audio",mediaUrl:m,caption:e.caption||""}}else if(e.voice){const m=await B(e.voice.file_id);h={...d,type:"voice",mediaUrl:m,caption:e.caption||""}}else if(e.document){const m=await B(e.document.file_id);h={...d,type:"document",mediaUrl:m,caption:e.caption||"",fileName:e.document.file_name||"T·ªáp"}}else if(e.sticker){const m=e.sticker;let k="tgs",I="";m.is_video?(k="webm",I=await B(m.file_id)):m.is_animated||(k="webp",I=await B(m.file_id));const q={file_id:m.file_id,url:I,emoji:m.emoji||"",is_animated:m.is_animated,is_video:m.is_video,set_name:m.set_name,width:m.width,height:m.height};sn(E,q),h={...d,type:"sticker",mediaUrl:I,stickerFormat:k,emoji:m.emoji||""}}else h={...d,type:"text",text:a("unsupportedContent")};if(re(n,h)){if(c){const m=L(n),k=_(n),I=k&&(k.type==="group"||k.type==="supergroup");X(h,o.messagesEl,K,{canDeleteOthers:m.canDeleteMessages,isGroupChat:I,onUserClick:we}),C.autoScroll&&u?(R(o.messagesEl),o.newMsgBtn.style.display="none"):Ce(o.newMsgBtn,o.messagesEl)}else i.unread=(i.unread||0)+1,Jo(i,h,o.toastsEl,{playSound:C.sound,push:C.push,scrollToMessage:window.scrollToMessage});N(b,f,o.emptyNoticeEl,o.chatListEl,w,Et),c&&ct(i,o.membersBtnEl),D(E,b)}}async function vr(e){if(!e||!M.id)return L(e);try{const t=await Tt(e,M.id);if(t.ok){const n=t.result,r={canDeleteMessages:!!n.can_delete_messages,canPromoteMembers:!!n.can_promote_members,canRestrictMembers:!!n.can_restrict_members,canChangeInfo:!!n.can_change_info,canInviteUsers:!!n.can_invite_users};return Wt(e,r),r}}catch(t){console.warn("Kh√¥ng l·∫•y ƒë∆∞·ª£c quy·ªÅn bot:",t)}return L(e)}async function B(e){try{const t=await qe(e);if(!t.ok)throw new Error(t.description);return Ge(t.result.file_path)}catch(t){return console.error("Failed to get file URL:",t),""}}function Cr(e){if(e.target.closest(".msg-action-btn"))return;const t=e.target.closest(".message");if(!t)return;const n=t.dataset.msgId,r=t.innerText.slice(0,30).replace("/ /g"," ");_r(n,r)}function _r(e,t){Kt(e),o.replyText.textContent=t,o.replyContext.classList.remove("hidden")}function Me(){jt(),o.replyContext.classList.add("hidden")}async function Re(){const e=o.inputEl.value.trim();if(!e)return;if(!E){alert(a("needToken"));return}if(!f){alert(a("pleaseSelectConversation"));return}const t={chat_id:f,text:e};A&&(t.reply_to_message_id=parseInt(A,10));const n=ge(o.messagesEl);o.inputEl.value="",Me(),ne();try{const r=await v("sendMessage",t);if(r.ok){const s=r.result,i={id:s.message_id,side:"right",type:"text",text:e,date:s.date*1e3,fromName:a("you"),reply_to:t.reply_to_message_id,reply_preview:A?oe(e):null},l=f;if($(l),re(l,i)){const c=L(l);X(i,o.messagesEl,K,{canDeleteOthers:c.canDeleteMessages}),C.autoScroll&&n?(R(o.messagesEl),o.newMsgBtn.style.display="none"):Ce(o.newMsgBtn,o.messagesEl),N(b,f,o.emptyNoticeEl,o.chatListEl,w),D(E,b)}}else alert(a("messageSendFailed",{error:r.description||a("unknownError")}))}catch(r){alert(a("networkError",{error:r.message}))}}async function Br(e){if(!e||!f){alert(a("selectFile"));return}const t=o.inputEl.value.trim();o.inputEl.value="",Me(),ne();const n=new FormData;n.append("chat_id",f),t&&n.append("caption",t);let r="sendDocument",s="document",i="document";e.type.startsWith("image/")?(r="sendPhoto",s="photo",i="photo"):e.type.startsWith("video/")?(r="sendVideo",s="video",i="video"):e.type.startsWith("audio/")&&(r="sendAudio",s="audio",i="audio"),n.append(s,e,e.name||void 0);const l=ge(o.messagesEl);try{const c=await vt(r,n);if(c.ok){const u=c.result;let p="",d=e.name||"";if(i==="photo"){const k=u.photo[u.photo.length-1];p=await B(k.file_id)}else i==="video"?p=await B(u.video.file_id):i==="audio"?p=await B(u.audio.file_id):(p=await B(u.document.file_id),d=u.document.file_name||d);const h={id:u.message_id,side:"right",type:i,mediaUrl:p,caption:t,fileName:d,date:u.date*1e3,fromName:a("you")},m=f;if($(m),re(m,h)){const k=L(m);X(h,o.messagesEl,K,{canDeleteOthers:k.canDeleteMessages}),C.autoScroll&&l?(R(o.messagesEl),o.newMsgBtn.style.display="none"):Ce(o.newMsgBtn,o.messagesEl),N(b,f,o.emptyNoticeEl,o.chatListEl,w),D(E,b)}}else alert(a("fileSendFailed",{error:c.description||a("unknownError")}))}catch(c){alert(a("networkError",{error:c.message}))}}async function K(e){if(!confirm(a("confirmDelete")))return;const t=f;if(t)try{const n=await It(t,e);if(n.ok){Xt(t,e);const r=_(t),s=L(t);de(r,o.messagesEl,K,{canDeleteOthers:s.canDeleteMessages,isGroupChat:r.type==="group"||r.type==="supergroup",onUserClick:we}),N(b,f,o.emptyNoticeEl,o.chatListEl,w),D(E,b),g(a("success"),a("messageDeleted"),o.toastsEl)}else{const r=n.description||a("cannotDeleteMessage");g(a("error"),r,o.toastsEl)}}catch(n){g(a("error"),a("networkError",{error:n.message}),o.toastsEl)}}async function $e(){var t;const e=(t=o.openChatInputEl)==null?void 0:t.value.trim();if(!e){g(a("warning"),a("enterChatIdOrUsername"),o.toastsEl);return}try{let n=e;if(e.startsWith("@")){const s=e.substring(1);g(a("searching"),a("searchingForUser",{username:s}),o.toastsEl),n="@"+s}const r=await Mt(n);if(r.ok){const s=r.result,i=String(s.id),c=s.type==="private"?[s.first_name,s.last_name].filter(Boolean).join(" ")||s.username||a("user"):s.title||s.type||"Chat";_(i)||($(i,{type:s.type,title:c,avatarText:F(c)}),g(a("found"),c,o.toastsEl)),N(b,f,o.emptyNoticeEl,o.chatListEl,w),w(i),o.openChatInputEl&&(o.openChatInputEl.value="")}else g(a("notFound"),r.description||a("chatNotFound"),o.toastsEl)}catch(n){g(a("error"),a("searchError",{error:n.message}),o.toastsEl)}}function He(){!f||!E||_t(f,"typing").catch(()=>{})}function Ir(){He(),me=setInterval(He,4e3)}function ne(){clearInterval(me),me=null}async function Et(e){e&&(Ht(e),D(E,b),f===e&&(ze(null),hn(o.messagesEl),ee(null,o.headerTitleEl,o.activeAvatarEl),o.inputEl.disabled=!0),N(b,f,o.emptyNoticeEl,o.chatListEl,w,Et),g("Th√†nh c√¥ng","ƒê√£ x√≥a chat",o.toastsEl))}function we(e,t,n=null){if(!e||!f)return;const r=_(f);!r||r.type!=="group"&&r.type!=="supergroup"||(window.currentUserAction={userId:e,userName:t,userUsername:n,chatId:f},Mr(t,n,e))}function Mr(e,t=null,n=null){const r=[];r.push(`<strong>${e}</strong>`),t&&r.push(`@${t}`),n&&r.push(`ID: ${n}`),o.userActionsTitle.innerHTML=r.join(" ‚Ä¢ "),o.userActionsMenu.classList.remove("hidden")}function Q(){o.userActionsMenu.classList.add("hidden"),window.currentUserAction=null}async function S(e){if(!window.currentUserAction)return;const{userId:t,userName:n,userUsername:r,chatId:s}=window.currentUserAction;try{switch(e){case"copyId":t&&navigator.clipboard.writeText(t.toString()).then(()=>{g("Th√†nh c√¥ng",`ƒê√£ copy ID: ${t}`,o.toastsEl)}).catch(()=>{g("L·ªói","Kh√¥ng th·ªÉ copy ID",o.toastsEl)});break;case"copyUsername":if(r){const i=r.startsWith("@")?r:`@${r}`;navigator.clipboard.writeText(i).then(()=>{g("Th√†nh c√¥ng",`ƒê√£ copy username: ${i}`,o.toastsEl)}).catch(()=>{g("L·ªói","Kh√¥ng th·ªÉ copy username",o.toastsEl)})}else g("Th√¥ng b√°o","Ng∆∞·ªùi d√πng kh√¥ng c√≥ username",o.toastsEl);break;case"kick":confirm(`Kick ${n} kh·ªèi nh√≥m?`)&&(await sr(s,t),g("Th√†nh c√¥ng",`ƒê√£ kick ${n}`,o.toastsEl));break;case"promote":await ce(s,t,"admin"),g("Th√†nh c√¥ng",`ƒê√£ thƒÉng ${n} l√†m admin`,o.toastsEl);break;case"moderate":await ce(s,t,"moderator"),g("Th√†nh c√¥ng",`ƒê√£ thƒÉng ${n} l√†m moderator`,o.toastsEl);break;case"demote":await ce(s,t,"member"),g("Th√†nh c√¥ng",`ƒê√£ h·∫° ${n} th√†nh th√†nh vi√™n`,o.toastsEl);break;case"restrict":g("Th√¥ng b√°o","T√≠nh nƒÉng h·∫°n ch·∫ø quy·ªÅn ƒëang ph√°t tri·ªÉn",o.toastsEl);break}}catch(i){g("L·ªói",`Kh√¥ng th·ª±c hi·ªán t√°c v·ª•: ${i.message}`,o.toastsEl)}Q()}function wr(){o.stickerPanel.classList.contains("hidden")?Sr():Se()}function Sr(){o.stickerPanel.classList.remove("hidden");const e=rt(E);Promise.all(e.map(async n=>{if(!n.url&&n.file_id)try{const r=await qe(n.file_id);r.ok&&(n.url=Ge(r.result.file_path))}catch(r){console.warn("Failed to get sticker URL:",r)}return n})).then(n=>{pn(n,o.stickerList,Tr)})}function Se(){o.stickerPanel.classList.add("hidden")}async function Tr(e){if(!f){g("L·ªói","Ch·ªçn chat tr∆∞·ªõc",o.toastsEl);return}try{await Bt(f,e.file_id),Se();const t={id:Date.now(),side:"right",date:Date.now(),fromName:M.name||"Bot",type:"sticker",mediaUrl:e.url,stickerFormat:e.is_animated?"tgs":e.is_video?"webm":"webp",emoji:e.emoji||""};re(f,t),X(t,o.messagesEl,K,{canDeleteOthers:!1,isGroupChat:!1}),R(o.messagesEl)}catch(t){g("L·ªói",`Kh√¥ng g·ª≠i sticker: ${t.message}`,o.toastsEl)}}window.scrollToMessage=function(e,t){f!==e&&w(e),setTimeout(()=>{const n=document.querySelector(`[data-msg-id="${t}"]`);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.style.animation="pulse 1s ease-in-out",setTimeout(()=>{n.style.animation=""},1e3))},500)};document.addEventListener("DOMContentLoaded",ar);window.addEventListener("beforeunload",()=>{E&&D(E,b)});
