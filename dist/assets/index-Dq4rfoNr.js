(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();let ge="",ye="";function Ze(e){ge=e}function et(e){ye=e}function tt(){return"https://api.telegram.org"}function Ee(e){const t=`${tt()}/bot${ge}/${e}`,o=ye.trim();return o?o.replace(/\/+$/,"")+"/"+t:t}function nt(e){const t=`${tt()}/file/bot${ge}/${e}`,o=ye.trim();return o?o.replace(/\/+$/,"")+"/"+t:t}async function ot(e,t){const o=t?"?"+new URLSearchParams(t).toString():"";return(await fetch(Ee(e)+o)).json()}async function k(e,t){return(await fetch(Ee(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t||{})})).json()}async function st(e,t){return(await fetch(Ee(e),{method:"POST",body:t})).json()}async function rt(){return ot("getMe")}async function Pt(e,t=0,o=["message","edited_message","channel_post","edited_channel_post"]){return k("getUpdates",{offset:e,timeout:t,allowed_updates:o})}async function Ot(e,t="typing"){return k("sendChatAction",{chat_id:e,action:t})}async function Rt(e,t){return k("sendSticker",{chat_id:e,sticker:t})}async function Ft(e,t){return k("deleteMessage",{chat_id:e,message_id:parseInt(t,10)})}async function it(e){return ot("getFile",{file_id:e})}async function Ht(e){return k("getChat",{chat_id:e})}async function $t(e){return k("getChatAdministrators",{chat_id:e})}async function Kt(e,t,o){return k("banChatMember",{chat_id:e,user_id:t})}async function ie(e,t,o={}){return k("promoteChatMember",{chat_id:e,user_id:t,can_manage_chat:o.can_manage_chat!==!1,can_delete_messages:o.can_delete_messages!==!1,can_manage_video_chats:o.can_manage_video_chats!==!1,can_restrict_members:o.can_restrict_members!==!1,can_promote_members:o.can_promote_members||!1,can_change_info:o.can_change_info!==!1,can_invite_users:o.can_invite_users!==!1,can_pin_messages:o.can_pin_messages!==!1,is_anonymous:o.is_anonymous||!1})}async function jt(e,t,o={},s){return k("restrictChatMember",{chat_id:e,user_id:t,permissions:o})}async function Yt(e,t){return k("getChatMember",{chat_id:e,user_id:t})}async function Gt(e,t){return k("setChatTitle",{chat_id:e,title:t})}async function Wt(e,t){return k("setChatDescription",{chat_id:e,description:t})}async function Xt(e,t){const o=new FormData;return o.append("chat_id",e),o.append("photo",t),st("setChatPhoto",o)}async function qt(e=!1){return k("deleteWebhook",{drop_pending_updates:e})}async function Vt(e,t){return k("getMyCommands",{})}async function Jt(e){return k("getMyDescription",{})}async function zt(e){return k("getMyShortDescription",{})}function Qt(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function R(e){var i,c;const t=(e||"").trim();if(!t)return"?";const o=t.split(/\s+/).filter(Boolean),s=((i=o[0])==null?void 0:i[0])||"",r=((c=o[1])==null?void 0:c[0])||"";return(s+r).toUpperCase()||s.toUpperCase()||"?"}function oe(e){return(e||"").replace(/\s+/g," ").slice(0,60)}function Zt(e){return e.from?[e.from.first_name,e.from.last_name].filter(Boolean).join(" ")||e.from.username||"Ng∆∞·ªùi d√πng":e.author_signature?e.author_signature:"H·ªá th·ªëng"}function en(e){return e.from&&e.from.username?e.from.username:null}function tn(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),o=e.createGain();t.type="sine",t.frequency.value=680,o.gain.value=.04,t.connect(o),o.connect(e.destination),t.start(),setTimeout(()=>{t.stop(),e.close()},180)}catch{}}function F(e){e&&(e.scrollTop=e.scrollHeight)}function be(e){return e?e.scrollTop+e.clientHeight>=e.scrollHeight-20:!0}let E="",v=new Map,u=null,ve=0,M=at(),A=null;function Z(){return{canDeleteMessages:!1,canPromoteMembers:!1,canRestrictMembers:!1,canChangeInfo:!1,canInviteUsers:!1}}function at(){return{id:null,username:null,name:null,description:null,shortDescription:null,commands:[]}}function ke(e){if(!e)return e;if(e.messageIds instanceof Set||(e.messageIds=new Set(e.messageIds||[])),!(e.members instanceof Map)){let t=[];Array.isArray(e.members)?t=e.members:e.members&&typeof e.members=="object"&&(t=Object.entries(e.members)),e.members=new Map(t.map(([o,s])=>[String(o),s]))}return e.permissions={...Z(),...e.permissions||{}},e.avatarText||(e.avatarText="?"),e}function nn(e){if(!e||!e.id)return null;const t=String(e.id),o=e.first_name||e.firstName||"",s=e.last_name||e.lastName||"",r=e.displayName||[o,s].filter(Boolean).join(" ")||e.username||e.name||"Ng∆∞·ªùi d√πng",i=e.avatarText||R(r),c=e.status||(e.isCreator?"creator":e.isAdmin?"administrator":"member");return{id:t,firstName:o||null,lastName:s||null,username:e.username||null,displayName:r,avatarText:i,status:c,isAdmin:e.isAdmin??(c==="administrator"||c==="creator"),isCreator:e.isCreator??c==="creator",isBot:e.isBot??e.is_bot??!1,joinedDate:e.joinedDate||e.joined_date||null,lastSeen:e.lastSeen||Date.now(),raw:e.raw||null}}function Ye(e){return e.isCreator?0:e.status==="administrator"||e.isAdmin?1:e.status==="moderator"?2:3}function ct(e){E=e}function on(e){const t=new Map;e&&typeof e.forEach=="function"&&e.forEach((o,s)=>{const r=ke({...o,id:String(o.id||s)});t.set(String(s),r)}),v=t}function sn(e,t){const o=ke({...t,id:String(e)});v.set(String(e),o)}function b(e){return v.get(String(e))}function rn(e){v.delete(String(e))}function lt(e){u=String(e)||null}function dt(e){ve=e}function mt(e){M={...M,...e}}function an(e){A=e}function cn(){A=null}function ln(){v=new Map,u=null,A=null,ve=0,M=at()}function dn(e){const t=b(e);return(t==null?void 0:t.members)||new Map}function ut(e){const t=dn(e);return Array.from(t.values()).sort((o,s)=>{const r=Ye(o)-Ye(s);return r!==0?r:(o.displayName||"").localeCompare(s.displayName||"","vi",{sensitivity:"base"})})}function de(e,t){if(!e||!t)return null;const o=H(e),s=nn(t);if(!s)return null;const r=o.members.get(s.id)||{},i={...r,...s,avatarText:s.avatarText||r.avatarText||R(s.displayName||""),lastSeen:s.lastSeen||r.lastSeen||Date.now()};return o.members.set(s.id,i),i}function mn(e,t){const o=b(e);return!o||!t?!1:o.members.delete(String(t))}function un(e,t){if(!e)return;const o=H(e);o.permissions={...o.permissions,...t}}function S(e){const t=b(e);return t?{...Z(),...t.permissions||{}}:Z()}function se(e,t){const o=b(e);return!o||o.messageIds.has(t.id)?!1:(o.messageIds.add(t.id),o.messages.push(t),o.lastText=t.type==="text"?t.text:t.caption||t.text||"["+t.type+"]",o.lastDate=t.date,!0)}function pn(e,t){const o=b(e);if(!o)return!1;const s=o.messages.findIndex(r=>r.id===t);return s===-1?!1:(o.messages.splice(s,1),o.messageIds.delete(t),!0)}function H(e,t={}){let o=b(e);if(o)o=ke(o);else{const s={id:String(e),type:t.type||"unknown",title:t.title||"Chat "+e,avatarText:t.avatarText||(t.title?R(t.title):"?"),messages:[],messageIds:new Set,members:new Map,permissions:Z(),lastText:"",lastDate:0,unread:0,...t};sn(e,s),o=b(e)}return o}const Ce="tg_bot_chat_",pt="tg_bot_info_",ht="tg_last_update_id",me="tg_theme_preference",ft="tg_bot_stickers_",hn=30*24*60*60;function Be(e){try{return encodeURIComponent(JSON.stringify(e))}catch{return""}}function Ie(e){try{return JSON.parse(decodeURIComponent(e))}catch{return null}}function W(e){const t=e+"=",o=document.cookie.split(";");for(let s of o)if(s=s.trim(),s.startsWith(t))return s.substring(t.length);return null}function $(e,t,o=hn/(24*60*60)){let s="";if(o){const r=new Date;r.setTime(r.getTime()+o*24*60*60*1e3),s="; expires="+r.toUTCString()}document.cookie=`${e}=${t}${s}; path=/; SameSite=Lax`}function gt(e){$(e,"",-1)}function x(e){if(!e)return null;const t=e.match(/^(\d+):/);return t?t[1]:String(fn(e))}function fn(e){let t=0;for(let o=0;o<e.length;o++){const s=e.charCodeAt(o);t=(t<<5)-t+s,t=t&t}return Math.abs(t)}function D(e,t){const o=x(e);if(!o)return!1;const s=Ce+o,r=Array.from(t.entries()).map(([i,c])=>{let l;c.members instanceof Map?l=c.members:Array.isArray(c.members)?l=new Map(c.members):c.members&&typeof c.members=="object"?l=new Map(Object.entries(c.members)):l=new Map;const m=Array.from(l.entries());return[i,{...c,messageIds:Array.from(c.messageIds||[]),members:m,permissions:{...c.permissions||{}}}]});try{const i=Be(r);return $(s,i),!0}catch(i){return console.error("Failed to save chat history:",i),!1}}function gn(e){const t=x(e);if(!t)return new Map;const o=Ce+t,s=W(o);if(!s)return new Map;const r=Ie(s);if(!Array.isArray(r))return new Map;const i=new Map;for(const[c,l]of r){let m=new Map;Array.isArray(l.members)?m=new Map(l.members.map(([f,d])=>[String(f),d])):l.members&&typeof l.members=="object"&&(m=new Map(Object.entries(l.members).map(([f,d])=>[String(f),d]))),i.set(c,{...l,messageIds:new Set(l.messageIds||[]),members:m,permissions:{...l.permissions||{}}})}return i}function yn(e,t){const o=x(e);if(!o)return!1;const s=pt+o;try{const r=Be(t);return $(s,r),!0}catch(r){return console.error("Failed to save bot info:",r),!1}}function En(e){const t=x(e);if(!t)return null;const o=pt+t,s=W(o);return s?Ie(s):null}function bn(){const e=W(ht);return e&&parseInt(e,10)||0}function vn(e){$(ht,String(e))}function kn(e){const t=x(e);if(!t)return!1;const o=Ce+t;return gt(o),!0}function Cn(){const e=localStorage.getItem("bot_token");if(!e)return!1;const t="chat_history_"+e,o=localStorage.getItem(t);if(o)try{const s=JSON.parse(o),r=new Map;for(const[i,c]of s)r.set(i,{...c,messageIds:new Set(c.messageIds||[])});return D(e,r),!0}catch(s){return console.warn("Migration failed:",s),!1}return!1}function Bn(e){if(!e){gt(me);return}$(me,encodeURIComponent(e))}function In(){const e=W(me);return e?decodeURIComponent(e):null}function _n(e,t){const o=x(e);if(!o||!t||!t.file_id)return!1;const s=ft+o,r=yt(e);if(r.some(l=>l.file_id===t.file_id))return!0;const c=[t,...r].slice(0,100);try{const l=Be(c);return $(s,l),!0}catch(l){return console.error("Failed to save sticker:",l),!1}}function yt(e){const t=x(e);if(!t)return[];const o=ft+t,s=W(o);if(!s)return[];const r=Ie(s);return Array.isArray(r)?r:[]}const ae={en:{appTitle:"Telegram Bot",loading:"Loading...",saving:"Saving...",save:"Save",cancel:"Cancel",close:"Close",delete:"Delete",refresh:"Refresh",search:"Search",ok:"OK",yes:"Yes",no:"No",you:"You",user:"User",statusDisconnected:"Not connected (missing token)",statusConnecting:"Connecting...",statusConnected:"Receiving updates...",statusError:"Error: {error}",noChatSelected:"No chat selected",noConversations:"No conversations yet. When messages arrive, they will appear here.",enterChatId:"Enter chat ID or @username",openChat:"Open chat",enterMessage:"Type a message...",noConversationSelected:"No conversation selected",send:"Send",attach:"Attach",sticker:"Sticker",replyingTo:"Replying to:",cancelReply:"Cancel reply",newMessage:"‚Üì New message",deleteMessage:"Delete message",confirmDelete:"Are you sure you want to delete this message?",messageDeleted:"Message deleted",messageSendFailed:"Send failed: {error}",networkError:"Network error: {error}",photo:"Photo",file:"File",unsupportedContent:"[Cannot display this content type]",animatedSticker:"[Animated sticker]",settingsTitle:"Settings",botConnection:"Bot Connection",botToken:"Bot Token (botXXXXXXXX:YYYYYYYYYYYYYYYY)",corsProxy:"CORS proxy prefix (optional, e.g.: https://cors.isomorphic-git.org/)",testConnection:"Test",deleteWebhook:"Delete webhook",enableNotifications:"Enable notifications",saveAndConnect:"Save & Connect",settingsHint:"If you get a 409 error while polling, delete the webhook. If you have CORS issues, add a proxy prefix.",enterToken:"‚ùå Enter Bot Token!",tokenMissing:"Token not found.",connectionOk:"‚úÖ OK: @{username} ‚Ä¢ id={id}",connectionNoUsername:"(no username)",connectionFailed:"‚ùå getMe error: {error}",connectionNetworkError:"‚ùå CORS or network error: {error}",webhookDeleted:"‚úÖ Webhook deleted.",webhookDeleteFailed:"‚ùå Could not delete: {error}",webhookDeleteNetworkError:"‚ùå Network error deleting webhook: {error}",notificationsGranted:"‚úÖ Notifications: permission granted.",notificationsDenied:"‚ùå Notifications: denied or not granted.",unknownError:"Unknown error",theme:"Theme",themeLight:"Light",themeDark:"Dark",themeSystem:"System",changeTheme:"Change theme",language:"Language",languageEnglish:"English",languageVietnamese:"Ti·∫øng Vi·ªát",botInfo:"Bot Information",botName:"Name:",botUsername:"Username:",botId:"Bot ID:",botDescription:"Description:",botShortDescription:"Short description:",botCommands:"Command list",botFeatures:"Supported features",noData:"‚Äî",featureThemes:"Light / dark / system theme",featurePushNotifications:"Push notifications for new messages",featureChatHistory:"Save chat history in browser",featureMemberManagement:"Member management & permissions",featureSendMessages:"Send text and media messages",preferences:"Preferences",prefAutoScroll:"Auto-scroll to new messages",prefSound:"Notification sound",prefPush:"Push notifications when tab is inactive",manageMembers:"Manage members",groupManagement:"Group Management",members:"Members",groupInfo:"Group Info",groupName:"Group name",groupDescription:"Description",groupPhoto:"Profile picture",saveChanges:"Save changes",loadingMembers:"Loading...",memberCount:"{count} members",memberInfo:"Member Information",memberName:"Name",memberUsername:"Username",memberId:"ID",memberStatus:"Status",memberJoined:"Joined",memberActions:"Member Actions",statusCreator:"Creator",statusAdministrator:"Administrator",statusModerator:"Moderator",statusMember:"Member",statusRestricted:"Restricted",statusLeft:"Left",statusKicked:"Kicked",promoteAdmin:"‚≠ê Promote to admin",promoteModerator:"üõ°Ô∏è Moderator",demoteToMember:"üë§ Member",kickUser:"üö´ Kick",copyId:"üìã Copy ID",copyUsername:"üìã Copy username",restrictUser:"üîí Restrict permissions",userActions:"User Actions",success:"‚úÖ Success",error:"‚ùå Error",warning:"‚ö†Ô∏è Warning",info:"‚ÑπÔ∏è Info",searching:"üîç Searching...",found:"‚úÖ Found",notFound:"‚ùå Not found",pleaseSelectChat:"Please select a chat first.",needToken:"You need to enter a token.",pleaseSelectConversation:"Please select a conversation.",enterChatIdOrUsername:"Please enter chat ID or username",searchingForUser:"Searching for @{username}",chatNotFound:"Chat does not exist or bot does not have access",searchError:"Error during search: {error}",idCopied:"ID copied to clipboard",usernameCopied:"Username copied to clipboard",memberKicked:"Member kicked",memberPromoted:"Member promoted",memberDemoted:"Member demoted",permissionDenied:"Permission denied",cannotDeleteMessage:"Cannot delete message (check bot permissions)",webhookActive:"Webhook is active. Delete webhook in Settings.",getUpdatesError:"getUpdates error: {error}",corsError:"CORS or network error during getUpdates",chatAction:"typing...",groupSettingsSaved:"Group settings saved",groupSettingsFailed:"Failed to save group settings: {error}",selectFile:"No file or chat selected.",fileSendFailed:"File send failed: {error}",kickConfirm:"Are you sure you want to kick {name}?",promoteConfirm:"Promote {name} to administrator?",demoteConfirm:"Demote {name} to regular member?",closeStickerPanel:"Close",noStickers:"No stickers yet. Received stickers will appear here.",errorUnknown:"Unknown error",errorNetwork:"Network error",errorPermission:"Permission error",errorNotFound:"Not found"},vi:{appTitle:"Telegram Bot",loading:"ƒêang t·∫£i...",saving:"ƒêang l∆∞u...",save:"L∆∞u",cancel:"H·ªßy",close:"ƒê√≥ng",delete:"X√≥a",refresh:"L√†m m·ªõi",search:"T√¨m ki·∫øm",ok:"OK",yes:"C√≥",no:"Kh√¥ng",you:"B·∫°n",user:"Ng∆∞·ªùi d√πng",statusDisconnected:"Ch∆∞a k·∫øt n·ªëi (thi·∫øu token)",statusConnecting:"ƒêang k·∫øt n·ªëi...",statusConnected:"ƒêang nh·∫≠n c·∫≠p nh·∫≠t...",statusError:"L·ªói: {error}",noChatSelected:"Ch∆∞a ch·ªçn cu·ªôc tr√≤ chuy·ªán",noConversations:"Ch∆∞a c√≥ cu·ªôc tr√≤ chuy·ªán. Khi c√≥ tin nh·∫Øn ƒë·∫øn, m·ª•c s·∫Ω hi·ªán ·ªü ƒë√¢y.",enterChatId:"Nh·∫≠p chat ID ho·∫∑c @username",openChat:"M·ªü chat",enterMessage:"Nh·∫≠p tin nh·∫Øn...",noConversationSelected:"Ch∆∞a ch·ªçn cu·ªôc tr√≤ chuy·ªán",send:"G·ª≠i",attach:"ƒê√≠nh k√®m",sticker:"Sticker",replyingTo:"ƒêang tr·∫£ l·ªùi:",cancelReply:"H·ªßy tr·∫£ l·ªùi",newMessage:"‚Üì Tin m·ªõi",deleteMessage:"X√≥a tin nh·∫Øn",confirmDelete:"B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tin nh·∫Øn n√†y?",messageDeleted:"ƒê√£ x√≥a tin nh·∫Øn",messageSendFailed:"G·ª≠i th·∫•t b·∫°i: {error}",networkError:"L·ªói m·∫°ng: {error}",photo:"·∫¢nh",file:"T·ªáp",unsupportedContent:"[Kh√¥ng hi·ªÉn th·ªã lo·∫°i n·ªôi dung n√†y]",animatedSticker:"[Sticker ƒë·ªông]",settingsTitle:"Trung t√¢m c√†i ƒë·∫∑t",botConnection:"K·∫øt n·ªëi bot",botToken:"Bot Token (botXXXXXXXX:YYYYYYYYYYYYYYYY)",corsProxy:"CORS proxy prefix (tu·ª≥ ch·ªçn, vd: https://cors.isomorphic-git.org/)",testConnection:"Ki·ªÉm tra",deleteWebhook:"X√≥a webhook",enableNotifications:"B·∫≠t th√¥ng b√°o",saveAndConnect:"L∆∞u & K·∫øt n·ªëi",settingsHint:"N·∫øu nh·∫≠n l·ªói 409 khi polling, h√£y x√≥a webhook. N·∫øu b·ªã CORS, th√™m proxy prefix.",enterToken:"‚ùå Nh·∫≠p Bot Token!",tokenMissing:"Ch∆∞a c√≥ token.",connectionOk:"‚úÖ OK: @{username} ‚Ä¢ id={id}",connectionNoUsername:"(kh√¥ng t√™n)",connectionFailed:"‚ùå L·ªói getMe: {error}",connectionNetworkError:"‚ùå CORS ho·∫∑c m·∫°ng l·ªói: {error}",webhookDeleted:"‚úÖ ƒê√£ x√≥a webhook.",webhookDeleteFailed:"‚ùå Kh√¥ng x√≥a ƒë∆∞·ª£c: {error}",webhookDeleteNetworkError:"‚ùå L·ªói m·∫°ng khi x√≥a webhook: {error}",notificationsGranted:"‚úÖ Th√¥ng b√°o: ƒë√£ c·∫•p quy·ªÅn.",notificationsDenied:"‚ùå Th√¥ng b√°o: b·ªã t·ª´ ch·ªëi ho·∫∑c ch∆∞a c·∫•p.",unknownError:"Kh√¥ng r√µ",theme:"Giao di·ªán",themeLight:"S√°ng",themeDark:"T·ªëi",themeSystem:"H·ªá th·ªëng",changeTheme:"ƒê·ªïi giao di·ªán",language:"Ng√¥n ng·ªØ",languageEnglish:"English",languageVietnamese:"Ti·∫øng Vi·ªát",botInfo:"Th√¥ng tin bot",botName:"T√™n:",botUsername:"Username:",botId:"Bot ID:",botDescription:"M√¥ t·∫£:",botShortDescription:"M√¥ t·∫£ ng·∫Øn:",botCommands:"Danh s√°ch l·ªánh",botFeatures:"T√≠nh nƒÉng h·ªó tr·ª£",noData:"‚Äî",featureThemes:"Giao di·ªán s√°ng / t·ªëi / h·ªá th·ªëng",featurePushNotifications:"Th√¥ng b√°o ƒë·∫©y khi c√≥ tin nh·∫Øn m·ªõi",featureChatHistory:"L∆∞u l·ªãch s·ª≠ h·ªôi tho·∫°i trong tr√¨nh duy·ªát",featureMemberManagement:"Qu·∫£n l√Ω th√†nh vi√™n & ch·ªânh s·ª≠a quy·ªÅn",featureSendMessages:"G·ª≠i tin nh·∫Øn vƒÉn b·∫£n v√† media",preferences:"T√πy ch·ªçn",prefAutoScroll:"T·ª± ƒë·ªông cu·ªôn ƒë·∫øn tin m·ªõi",prefSound:"√Çm b√°o th√¥ng b√°o",prefPush:"Th√¥ng b√°o ƒë·∫©y khi tab kh√¥ng ho·∫°t ƒë·ªông",manageMembers:"Qu·∫£n l√Ω th√†nh vi√™n",groupManagement:"Qu·∫£n l√Ω nh√≥m",members:"Th√†nh vi√™n",groupInfo:"Th√¥ng tin nh√≥m",groupName:"T√™n nh√≥m",groupDescription:"M√¥ t·∫£",groupPhoto:"·∫¢nh ƒë·∫°i di·ªán",saveChanges:"L∆∞u thay ƒë·ªïi",loadingMembers:"ƒêang t·∫£i...",memberCount:"{count} th√†nh vi√™n",memberInfo:"Th√¥ng tin th√†nh vi√™n",memberName:"T√™n",memberUsername:"Username",memberId:"ID",memberStatus:"Tr·∫°ng th√°i",memberJoined:"Tham gia",memberActions:"T√°c v·ª•",statusCreator:"Ch·ªß nh√≥m",statusAdministrator:"Qu·∫£n tr·ªã vi√™n",statusModerator:"Ng∆∞·ªùi ki·ªÉm duy·ªát",statusMember:"Th√†nh vi√™n",statusRestricted:"B·ªã h·∫°n ch·∫ø",statusLeft:"ƒê√£ r·ªùi",statusKicked:"ƒê√£ b·ªã kick",promoteAdmin:"‚≠ê ThƒÉng admin",promoteModerator:"üõ°Ô∏è Moderator",demoteToMember:"üë§ Th√†nh vi√™n",kickUser:"üö´ Kick",copyId:"üìã Copy ID",copyUsername:"üìã Copy username",restrictUser:"üîí H·∫°n ch·∫ø quy·ªÅn",userActions:"T√°c v·ª• v·ªõi ng∆∞·ªùi d√πng",success:"‚úÖ Th√†nh c√¥ng",error:"‚ùå L·ªói",warning:"‚ö†Ô∏è Ch√∫ √Ω",info:"‚ÑπÔ∏è Th√¥ng tin",searching:"üîç ƒêang t√¨m...",found:"‚úÖ T√¨m th·∫•y",notFound:"‚ùå Kh√¥ng t√¨m th·∫•y",pleaseSelectChat:"Ch·ªçn chat tr∆∞·ªõc.",needToken:"B·∫°n c·∫ßn nh·∫≠p token.",pleaseSelectConversation:"H√£y ch·ªçn cu·ªôc tr√≤ chuy·ªán.",enterChatIdOrUsername:"Vui l√≤ng nh·∫≠p chat ID ho·∫∑c username",searchingForUser:"ƒêang t√¨m @{username}",chatNotFound:"Chat kh√¥ng t·ªìn t·∫°i ho·∫∑c bot ch∆∞a c√≥ quy·ªÅn truy c·∫≠p",searchError:"L·ªói khi t√¨m ki·∫øm: {error}",idCopied:"ƒê√£ copy ID",usernameCopied:"ƒê√£ copy username",memberKicked:"ƒê√£ kick th√†nh vi√™n",memberPromoted:"ƒê√£ thƒÉng ch·ª©c",memberDemoted:"ƒê√£ h·∫° ch·ª©c",permissionDenied:"Kh√¥ng ƒë·ªß quy·ªÅn",cannotDeleteMessage:"Kh√¥ng th·ªÉ x√≥a tin nh·∫Øn (ki·ªÉm tra quy·ªÅn c·ªßa bot)",webhookActive:"Webhook ƒëang ho·∫°t ƒë·ªông. X√≥a webhook trong C√†i ƒë·∫∑t.",getUpdatesError:"L·ªói getUpdates: {error}",corsError:"CORS ho·∫∑c m·∫°ng l·ªói khi getUpdates",chatAction:"ƒëang nh·∫≠p...",groupSettingsSaved:"ƒê√£ l∆∞u c√†i ƒë·∫∑t nh√≥m",groupSettingsFailed:"Kh√¥ng th·ªÉ l∆∞u c√†i ƒë·∫∑t nh√≥m: {error}",selectFile:"Ch∆∞a ch·ªçn chat ho·∫∑c t·ªáp.",fileSendFailed:"G·ª≠i file th·∫•t b·∫°i: {error}",kickConfirm:"B·∫°n c√≥ ch·∫Øc mu·ªën kick {name}?",promoteConfirm:"ThƒÉng {name} l√™n qu·∫£n tr·ªã vi√™n?",demoteConfirm:"H·∫° {name} xu·ªëng th√†nh vi√™n th∆∞·ªùng?",closeStickerPanel:"ƒê√≥ng",noStickers:"Ch∆∞a c√≥ sticker. Sticker nh·∫≠n ƒë∆∞·ª£c s·∫Ω hi·ªán ·ªü ƒë√¢y.",errorUnknown:"L·ªói kh√¥ng x√°c ƒë·ªãnh",errorNetwork:"L·ªói m·∫°ng",errorPermission:"L·ªói quy·ªÅn",errorNotFound:"Kh√¥ng t√¨m th·∫•y"}},Et="tg_language",Y="en",bt=["en","vi"];let P=Y;function Mn(){return(navigator.language||navigator.userLanguage||"").toLowerCase().startsWith("vi")?"vi":"en"}function wn(){const e=localStorage.getItem(Et);return e&&bt.includes(e)?e:Mn()}function Sn(){return P=wn(),vt(P),P}function Tn(){return P}function Ln(e){return bt.includes(e)||(console.warn(`Language ${e} not supported, falling back to ${Y}`),e=Y),P=e,vt(e),e}function vt(e){try{localStorage.setItem(Et,e)}catch(t){console.warn("Failed to save language preference:",t)}}function a(e,t={}){let s=(ae[P]||ae[Y])[e]||ae[Y][e]||e;return Object.keys(t).forEach(r=>{const i=`{${r}}`;s=s.replace(new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),t[r])}),s}function X(e,t,o,s={}){const r=e.side==="right",i=r||s.canDeleteOthers,c=document.createElement("div");if(c.className="message "+(r?"right":"left")+(e.reply_to?" reply":""),c.dataset.msgId=e.id,i){const d=document.createElement("div");d.className="msg-actions";const h=document.createElement("button");h.className="msg-action-btn",h.textContent="üóëÔ∏è",h.title=a("deleteMessage"),h.addEventListener("click",p=>{p.stopPropagation(),o&&o(e.id)}),d.appendChild(h),c.appendChild(d)}if(e.reply_preview){const d=document.createElement("div");d.className="reply-to",d.textContent="‚Ü™ "+e.reply_preview,c.appendChild(d)}const l=document.createElement("div");if(e.type==="photo"){const d=document.createElement("img");if(d.src=e.mediaUrl,d.className="media",d.alt=e.caption||a("photo"),l.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",l.appendChild(h)}}else if(e.type==="video"){const d=document.createElement("video");if(d.src=e.mediaUrl,d.controls=!0,d.playsInline=!0,d.className="media",l.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",l.appendChild(h)}}else if(e.type==="audio"||e.type==="voice"){const d=document.createElement("audio");if(d.src=e.mediaUrl,d.controls=!0,d.className="media",l.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",l.appendChild(h)}}else if(e.type==="document"){const d=document.createElement("a");if(d.href=e.mediaUrl,d.target="_blank",d.rel="noopener noreferrer",d.className="doc-link",d.textContent=e.fileName||a("file"),l.appendChild(d),e.caption){const h=document.createElement("div");h.textContent=e.caption,h.style.marginTop="6px",l.appendChild(h)}}else e.type==="sticker"?xn(l,e):l.textContent=e.text;c.appendChild(l);const m=document.createElement("div");m.className="meta";const f=document.createElement("span");f.className="sender-name",f.textContent=e.fromName,s.isGroupChat&&s.onUserClick&&(f.style.cursor="pointer",f.style.textDecoration="underline",f.addEventListener("click",d=>{d.stopPropagation(),s.onUserClick(e.fromId,e.fromName,e.fromUsername)})),m.appendChild(f),m.appendChild(document.createTextNode(` ‚Ä¢ ${Qt(e.date)}`)),c.appendChild(m),t.appendChild(c)}function xn(e,t){if(t.stickerFormat==="webp"||t.stickerFormat==="static"){const o=document.createElement("img");o.src=t.mediaUrl,o.className="media sticker-image",o.alt=t.emoji||"Sticker",o.style.maxWidth="150px",o.style.maxHeight="150px",o.style.objectFit="contain",e.appendChild(o)}else if(t.stickerFormat==="webm"||t.stickerFormat==="video"){const o=document.createElement("video");o.src=t.mediaUrl,o.autoplay=!0,o.loop=!0,o.muted=!0,o.playsInline=!0,o.className="media sticker-video",o.style.maxWidth="150px",o.style.maxHeight="150px",o.style.objectFit="contain",e.appendChild(o)}else if(t.stickerFormat==="tgs"||t.stickerFormat==="animated"){const o=document.createElement("div");o.className="sticker-placeholder",o.style.fontSize="3rem",o.style.textAlign="center",o.style.padding="10px",o.textContent=t.emoji||"‚ú®",e.appendChild(o);const s=document.createElement("div");s.className="sticker-note",s.style.fontSize="0.75rem",s.style.color="var(--muted)",s.style.marginTop="4px",s.style.textAlign="center",s.textContent=a("animatedSticker"),e.appendChild(s)}else{const o=document.createElement("div");o.textContent="[Sticker] "+(t.emoji||""),e.appendChild(o)}}function N(e,t,o,s,r,i){s.innerHTML="";const c=Array.from(e.values()).sort((m,f)=>(f.lastDate||0)-(m.lastDate||0));if(s.querySelectorAll(".chat-item").forEach(m=>m.remove()),!c.length){o&&(o.style.display="block");return}o&&(o.style.display="none");for(const m of c){const f=document.createElement("div");f.className="chat-item"+(m.id===t?" active":""),f.dataset.chatId=m.id,f.innerHTML=`
      <div class="avatar">${m.avatarText}</div>
      <div class="info">
        <div class="name">${m.title}</div>
        <div class="last">${m.lastText?oe(m.lastText):"‚Äî"}</div>
      </div>
      <div class="badge${m.unread?"":" hidden"}">${m.unread||""}</div>
      <button class="delete-chat-btn" title="X√≥a chat">üóëÔ∏è</button>
    `,f.querySelector(".info, .avatar").addEventListener("click",()=>r(m.id)),f.querySelector(".delete-chat-btn").addEventListener("click",d=>{d.stopPropagation(),i&&confirm(`X√≥a chat "${m.title}"?`)&&i(m.id)}),s.appendChild(f)}}function ue(e,t,o,s={}){if(t.innerHTML="",!(!e||!e.messages))for(const r of e.messages)X(r,t,o,s)}function Dn(e){e&&(e.innerHTML="")}function ee(e,t,o){t&&(t.textContent=(e==null?void 0:e.title)||"Ch∆∞a ch·ªçn cu·ªôc tr√≤ chuy·ªán"),o&&(e?(o.textContent=e.avatarText||"?",o.style.display="grid"):o.style.display="none")}function kt(e,t){t&&(e&&(e.type==="group"||e.type==="supergroup")?t.style.display="block":t.style.display="none")}function _e(e,t){if(!e||!t)return;t.scrollTop+t.clientHeight>=t.scrollHeight-20||(e.style.display="block")}function Nn(e,t,o){if(t){if(t.innerHTML="",!e||e.length===0){const s=document.createElement("div");s.className="stickers-empty",s.textContent="Ch∆∞a c√≥ sticker n√†o",t.appendChild(s);return}e.forEach(s=>{const r=document.createElement("div");if(r.className="sticker-item",r.title=s.emoji||"Sticker",s.file_id&&s.url)if(s.is_animated)r.innerHTML=`<div class="sticker-thumb">${s.emoji||"‚ú®"}</div>`;else if(s.is_video){const i=document.createElement("video");i.src=s.url,i.autoplay=!0,i.loop=!0,i.muted=!0,i.playsInline=!0,i.className="sticker-thumb",r.appendChild(i)}else{const i=document.createElement("img");i.src=s.url,i.alt=s.emoji||"Sticker",i.className="sticker-thumb",r.appendChild(i)}else r.innerHTML=`<div class="sticker-thumb">${s.emoji||"‚ùì"}</div>`;r.addEventListener("click",()=>{o&&o(s)}),t.appendChild(r)})}}const Un=()=>document.getElementById("chatList"),An=()=>document.getElementById("emptyNotice"),Pn=()=>document.getElementById("messages"),On=()=>document.getElementById("newMsgBtn"),Rn=()=>document.getElementById("input"),Fn=()=>document.getElementById("sendBtn"),Hn=()=>document.getElementById("attachBtn"),$n=()=>document.getElementById("stickerBtn"),Kn=()=>document.getElementById("fileInput"),jn=()=>document.getElementById("replyContext"),Yn=()=>document.getElementById("replyText"),Gn=()=>document.getElementById("cancelReply"),Wn=()=>document.getElementById("stickerPanel"),Xn=()=>document.getElementById("closeStickerBtn"),qn=()=>document.getElementById("stickerList"),Vn=()=>document.getElementById("userActionsMenu"),Jn=()=>document.getElementById("userActionsTitle"),zn=()=>document.getElementById("closeUserActionsBtn"),Qn=()=>document.getElementById("copyIdBtn"),Zn=()=>document.getElementById("copyUsernameBtn"),eo=()=>document.getElementById("kickUserBtn"),to=()=>document.getElementById("promoteUserBtn"),no=()=>document.getElementById("moderateUserBtn"),oo=()=>document.getElementById("demoteUserBtn"),so=()=>document.getElementById("restrictUserBtn"),ro=()=>document.getElementById("status"),io=()=>document.getElementById("botInfo"),ao=()=>document.getElementById("headerTitle"),co=()=>document.getElementById("activeAvatar"),lo=()=>document.getElementById("themeToggleBtn"),mo=()=>document.getElementById("sidebar"),uo=()=>document.getElementById("menuToggle"),po=()=>document.getElementById("sidebarCloseBtn"),ho=()=>document.getElementById("openChatInput"),fo=()=>document.getElementById("openChatBtn"),go=()=>document.getElementById("membersBtn"),yo=()=>document.getElementById("membersOverlay"),Eo=()=>document.getElementById("membersList"),bo=()=>document.getElementById("closeMembersBtn"),vo=()=>document.getElementById("groupInfo"),ko=()=>document.getElementById("membersHint"),Co=()=>document.getElementById("overlay"),Bo=()=>document.getElementById("settingsBtn"),Io=()=>document.getElementById("saveBtn"),_o=()=>document.getElementById("cancelBtn"),Mo=()=>document.getElementById("tokenInput"),wo=()=>document.getElementById("proxyInput"),So=()=>document.getElementById("testBtn"),To=()=>document.getElementById("deleteWebhookBtn"),Lo=()=>document.getElementById("settingsHint"),xo=()=>document.getElementById("notifBtn"),Do=()=>document.getElementById("themeOptionLight"),No=()=>document.getElementById("themeOptionDark"),Uo=()=>document.getElementById("themeOptionSystem"),Ao=()=>document.getElementById("langOptionEn"),Po=()=>document.getElementById("langOptionVi"),Oo=()=>document.getElementById("botDetailName"),Ro=()=>document.getElementById("botDetailUsername"),Fo=()=>document.getElementById("botDetailId"),Ho=()=>document.getElementById("botDetailDescription"),$o=()=>document.getElementById("botDetailShortDescription"),Ko=()=>document.getElementById("botCommandsList"),jo=()=>document.getElementById("botFeatureList"),Yo=()=>document.getElementById("prefAutoScroll"),Go=()=>document.getElementById("prefSound"),Wo=()=>document.getElementById("prefPush"),Xo=()=>document.getElementById("membersTabBtn"),qo=()=>document.getElementById("groupTabBtn"),Vo=()=>document.getElementById("membersTab"),Jo=()=>document.getElementById("groupSettingsTab"),zo=()=>document.getElementById("refreshMembersBtn"),Qo=()=>document.getElementById("groupNameInput"),Zo=()=>document.getElementById("groupDescriptionInput"),es=()=>document.getElementById("groupPhotoInput"),ts=()=>document.getElementById("saveGroupBtn"),ns=()=>document.getElementById("memberModal"),os=()=>document.getElementById("memberModalAvatar"),ss=()=>document.getElementById("memberModalName"),rs=()=>document.getElementById("memberModalUsername"),is=()=>document.getElementById("memberModalId"),as=()=>document.getElementById("memberModalStatus"),cs=()=>document.getElementById("memberModalJoined"),ls=()=>document.getElementById("memberPromoteBtn"),ds=()=>document.getElementById("memberModeratorBtn"),ms=()=>document.getElementById("memberDemoteBtn"),us=()=>document.getElementById("memberRestrictBtn"),ps=()=>document.getElementById("memberKickBtn"),hs=()=>document.getElementById("closeMemberModalBtn"),fs=()=>document.getElementById("restrictModal"),gs=()=>document.getElementById("closeRestrictModalBtn"),ys=()=>document.getElementById("applyRestrictBtn"),Es=()=>document.getElementById("permSendMessages"),bs=()=>document.getElementById("permSendMedia"),vs=()=>document.getElementById("permSendPolls"),ks=()=>document.getElementById("permSendOther"),Cs=()=>document.getElementById("permAddWebPage"),Bs=()=>document.getElementById("permChangeInfo"),Is=()=>document.getElementById("permInviteUsers"),_s=()=>document.getElementById("permPinMessages"),Ms=()=>document.getElementById("toasts");function ws(){return{chatListEl:Un(),emptyNoticeEl:An(),messagesEl:Pn(),newMsgBtn:On(),inputEl:Rn(),sendBtn:Fn(),attachBtn:Hn(),fileInputEl:Kn(),replyContext:jn(),replyText:Yn(),cancelReply:Gn(),statusEl:ro(),botInfoEl:io(),headerTitleEl:ao(),activeAvatarEl:co(),themeToggleBtn:lo(),sidebarEl:mo(),menuToggleEl:uo(),sidebarCloseBtn:po(),openChatInputEl:ho(),openChatBtnEl:fo(),membersBtnEl:go(),membersOverlayEl:yo(),membersListEl:Eo(),closeMembersBtn:bo(),groupInfoEl:vo(),membersHintEl:ko(),membersTabBtn:Xo(),groupTabBtn:qo(),membersTabPanel:Vo(),groupSettingsTab:Jo(),refreshMembersBtn:zo(),groupNameInputEl:Qo(),groupDescriptionInputEl:Zo(),groupPhotoInputEl:es(),saveGroupBtn:ts(),memberModalEl:ns(),memberModalAvatarEl:os(),memberModalNameEl:ss(),memberModalUsernameEl:rs(),memberModalIdEl:is(),memberModalStatusEl:as(),memberModalJoinedEl:cs(),memberPromoteBtn:ls(),memberModeratorBtn:ds(),memberDemoteBtn:ms(),memberRestrictBtn:us(),memberKickBtn:ps(),closeMemberModalBtn:hs(),restrictModalEl:fs(),closeRestrictModalBtn:gs(),applyRestrictBtn:ys(),permSendMessagesEl:Es(),permSendMediaEl:bs(),permSendPollsEl:vs(),permSendOtherEl:ks(),permAddWebPageEl:Cs(),permChangeInfoEl:Bs(),permInviteUsersEl:Is(),permPinMessagesEl:_s(),overlayEl:Co(),settingsBtn:Bo(),saveBtn:Io(),cancelBtn:_o(),tokenInputEl:Mo(),proxyInputEl:wo(),testBtn:So(),deleteWebhookBtn:To(),settingsHintEl:Lo(),notifBtn:xo(),themeOptionLight:Do(),themeOptionDark:No(),themeOptionSystem:Uo(),langOptionEn:Ao(),langOptionVi:Po(),botDetailNameEl:Oo(),botDetailUsernameEl:Ro(),botDetailIdEl:Fo(),botDetailDescriptionEl:Ho(),botDetailShortDescriptionEl:$o(),botCommandsListEl:Ko(),botFeatureListEl:jo(),prefAutoScrollEl:Yo(),prefSoundEl:Go(),prefPushEl:Wo(),toastsEl:Ms(),stickerBtn:$n(),stickerPanel:Wn(),closeStickerBtn:Xn(),stickerList:qn(),userActionsMenu:Vn(),userActionsTitle:Jn(),closeUserActionsBtn:zn(),copyIdBtn:Qn(),copyUsernameBtn:Zn(),kickUserBtn:eo(),promoteUserBtn:to(),moderateUserBtn:no(),demoteUserBtn:oo(),restrictUserBtn:so()}}let V=null,ce=null,U=[],j=null,Ge=50;function Me(){return typeof window<"u"&&"Notification"in window}async function we(){return"serviceWorker"in navigator?V||(ce||(ce=navigator.serviceWorker.register("/sw.js").then(e=>(V=e,e)).catch(e=>(console.warn("Service worker registration failed:",e),V=null,null))),ce):null}function g(e,t,o,s={}){if(!o)return;const r={id:Date.now(),title:e,body:t,timestamp:new Date,chatId:s.chatId,messageId:s.messageId};U.unshift(r),U.length>Ge&&(U=U.slice(0,Ge)),j&&j.remove();const i=document.createElement("div");i.className="toast compact",j=i;const c=document.createElement("div");c.className="toast-content";const l=document.createElement("div");l.className="toast-title",l.textContent=e;const m=document.createElement("div");m.className="toast-body",m.textContent=t,c.appendChild(l),c.appendChild(m),i.appendChild(c);const f=document.createElement("button");f.className="toast-history-btn",f.textContent="üìã",f.title="Xem l·ªãch s·ª≠ th√¥ng b√°o",f.addEventListener("click",d=>{d.stopPropagation(),xs(o)}),i.appendChild(f),s.chatId&&(i.style.cursor="pointer",i.addEventListener("click",()=>{s.scrollToMessage&&typeof s.scrollToMessage=="function"&&s.scrollToMessage(s.chatId,s.messageId)})),o.appendChild(i),setTimeout(()=>{j===i&&(i.remove(),j=null)},4e3)}async function Ss(e,t,o,s={}){var i;const r=e.lastText||oe(t.text||t.caption||"["+(t.type||"tin nh·∫Øn")+"]");if(g(e.title,r,o,{chatId:e.id,messageId:t.id,scrollToMessage:s.scrollToMessage}),s.playSound!==!1&&tn(),!!Me()&&s.push!==!1&&document.hidden&&Notification.permission==="granted")try{const c={body:r,tag:`chat-${e.id}`,data:{chatId:e.id,messageId:t.id,url:((i=window==null?void 0:window.location)==null?void 0:i.href)||""}},l=await we();l&&l.showNotification?l.showNotification(e.title,c):new Notification(e.title,c)}catch(c){console.warn("Kh√¥ng th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o ƒë·∫©y:",c)}}async function Ts(){if(!Me())throw new Error("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Notifications");const e=await Notification.requestPermission();return e==="granted"&&await we(),e}async function Ls(){return Me()?we():null}function xs(e){if(!e)return;const t=document.getElementById("notificationHistoryModal");t&&t.remove();const o=document.createElement("div");o.id="notificationHistoryModal",o.className="overlay",o.innerHTML=`
    <div class="dialog dialog-large">
      <div class="dialog-header">
        <h3>L·ªãch s·ª≠ th√¥ng b√°o</h3>
        <button class="icon-btn close-history" title="ƒê√≥ng">‚úï</button>
      </div>
      <div class="notification-history">
        ${U.length===0?'<p class="empty-history">Ch∆∞a c√≥ th√¥ng b√°o n√†o</p>':""}
        ${U.map(s=>`
          <div class="history-item ${s.chatId?"clickable":""}" data-chat-id="${s.chatId||""}" data-message-id="${s.messageId||""}">
            <div class="history-header">
              <div class="history-title">${s.title}</div>
              <div class="history-time">${Ds(s.timestamp)}</div>
            </div>
            <div class="history-body">${s.body}</div>
          </div>
        `).join("")}
      </div>
    </div>
  `,o.querySelector(".close-history").addEventListener("click",()=>o.remove()),o.addEventListener("click",s=>{s.target===o&&o.remove()}),o.querySelectorAll(".history-item.clickable").forEach(s=>{s.addEventListener("click",()=>{const r=s.dataset.chatId,i=s.dataset.messageId;r&&typeof window.scrollToMessage=="function"&&(window.scrollToMessage(r,i),o.remove())})}),document.body.appendChild(o)}function Ds(e){const o=new Date-e,s=Math.floor(o/6e4),r=Math.floor(o/36e5),i=Math.floor(o/864e5);return s<1?"V·ª´a xong":s<60?`${s} ph√∫t tr∆∞·ªõc`:r<24?`${r} gi·ªù tr∆∞·ªõc`:i<7?`${i} ng√†y tr∆∞·ªõc`:e.toLocaleDateString("vi-VN")}const Ns={can_manage_chat:!0,can_delete_messages:!0,can_manage_video_chats:!0,can_restrict_members:!0,can_promote_members:!0,can_change_info:!0,can_invite_users:!0,can_pin_messages:!0,is_anonymous:!1},Us={can_manage_chat:!0,can_delete_messages:!0,can_manage_video_chats:!0,can_restrict_members:!0,can_promote_members:!1,can_change_info:!0,can_invite_users:!0,can_pin_messages:!0,is_anonymous:!1},As={can_manage_chat:!1,can_delete_messages:!1,can_manage_video_chats:!1,can_restrict_members:!1,can_promote_members:!1,can_change_info:!1,can_invite_users:!0,can_pin_messages:!1,is_anonymous:!1},Ps={can_send_messages:!0,can_send_audios:!0,can_send_documents:!0,can_send_photos:!0,can_send_videos:!0,can_send_video_notes:!0,can_send_voice_notes:!0,can_send_polls:!0,can_send_other_messages:!0,can_add_web_page_previews:!0,can_change_info:!1,can_invite_users:!0,can_pin_messages:!1,can_manage_topics:!1};async function Os(e){const t=await $t(e);if(!t.ok)throw new Error(t.description||"Kh√¥ng th·ªÉ t·∫£i danh s√°ch qu·∫£n tr·ªã vi√™n");return t.result||[]}async function le(e,t,o){const s=(o||"").toLowerCase();if(s==="admin"||s==="administrator")return ie(e,t,Ns);if(s==="moderator")return ie(e,t,Us);if(s==="member")return await ie(e,t,As),jt(e,t,Ps);throw new Error("Vai tr√≤ kh√¥ng h·ª£p l·ªá: "+o)}async function Rs(e,t,o){return Kt(e,t)}async function Fs(e,t){return Gt(e,t)}async function Hs(e,t){return Wt(e,t)}async function $s(e,t){return Xt(e,t)}function Ks(e){switch((e||"").toLowerCase()){case"creator":return"üëë Ch·ªß nh√≥m";case"administrator":return"‚≠ê Qu·∫£n tr·ªã vi√™n";case"moderator":return"üõ°Ô∏è ƒêi·ªÅu h√†nh";default:return"üë§ Th√†nh vi√™n"}}let n=null,js=null,pe=null,J=!1;const te={autoScroll:!0,sound:!0,push:!0};let B={...te},G="system",L=null,Ct="members";function Ys(){n=ws(),Sn(),Tt(),L=window.matchMedia("(prefers-color-scheme: dark)"),L.addEventListener?L.addEventListener("change",We):L.addListener&&L.addListener(We);const e=In();O(e||"system",!1),B=zs(),It(),Ls().catch(()=>{}),Qe(),window.addEventListener("resize",Qe),Cn();const t=localStorage.getItem("bot_token"),o=localStorage.getItem("cors_proxy")||"";if(t){ct(t),Ze(t),et(o);const s=gn(t);on(s);const r=bn();dt(r);const i=En(t);i&&(mt(i),xt()),Lt()}else n.overlayEl.classList.remove("hidden");Gs(),re()}function Gs(){var e,t,o,s,r,i,c,l,m,f,d,h,p,C,_,q,De,Ne,Ue,Ae,Pe,Oe,Re,Fe,He,$e,Ke,je;n.settingsBtn.addEventListener("click",Ws),n.saveBtn.addEventListener("click",Xs),n.cancelBtn.addEventListener("click",Bt),n.testBtn.addEventListener("click",qs),n.deleteWebhookBtn.addEventListener("click",Vs),n.notifBtn.addEventListener("click",Js),(e=n.themeToggleBtn)==null||e.addEventListener("click",Zs),(t=n.themeOptionLight)==null||t.addEventListener("click",()=>O("light")),(o=n.themeOptionDark)==null||o.addEventListener("click",()=>O("dark")),(s=n.themeOptionSystem)==null||s.addEventListener("click",()=>O("system")),(r=n.langOptionEn)==null||r.addEventListener("click",()=>Xe("en")),(i=n.langOptionVi)==null||i.addEventListener("click",()=>Xe("vi")),(c=n.prefAutoScrollEl)==null||c.addEventListener("change",y=>z("autoScroll",y.target.checked)),(l=n.prefSoundEl)==null||l.addEventListener("change",y=>z("sound",y.target.checked)),(m=n.prefPushEl)==null||m.addEventListener("change",y=>z("push",y.target.checked)),(f=n.openChatBtnEl)==null||f.addEventListener("click",Ve),(d=n.openChatInputEl)==null||d.addEventListener("keydown",y=>{y.key==="Enter"&&Ve()}),n.menuToggleEl.addEventListener("click",()=>{n.sidebarEl.classList.toggle("hidden-mobile")}),(h=n.sidebarCloseBtn)==null||h.addEventListener("click",()=>{n.sidebarEl.classList.toggle("hidden-mobile")}),n.messagesEl.addEventListener("click",rr),n.newMsgBtn.addEventListener("click",()=>{F(n.messagesEl),n.newMsgBtn.style.display="none"}),n.sendBtn.addEventListener("click",qe),n.inputEl.addEventListener("keydown",y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),qe())}),n.inputEl.addEventListener("focus",ur),n.inputEl.addEventListener("blur",ne),n.stickerBtn.addEventListener("click",hr),n.closeStickerBtn.addEventListener("click",xe),n.closeUserActionsBtn.addEventListener("click",Q),n.copyIdBtn.addEventListener("click",()=>T("copyId")),n.copyUsernameBtn.addEventListener("click",()=>T("copyUsername")),n.kickUserBtn.addEventListener("click",()=>T("kick")),n.promoteUserBtn.addEventListener("click",()=>T("promote")),n.moderateUserBtn.addEventListener("click",()=>T("moderate")),n.demoteUserBtn.addEventListener("click",()=>T("demote")),n.restrictUserBtn.addEventListener("click",()=>T("restrict")),document.addEventListener("click",y=>{if(n.userActionsMenu&&!n.userActionsMenu.classList.contains("hidden")){const Ut=n.userActionsMenu.contains(y.target),At=y.target.classList.contains("sender-name");!Ut&&!At&&Q()}}),document.addEventListener("keydown",y=>{(y.key==="Escape"||y.key==="Esc")&&n.userActionsMenu&&!n.userActionsMenu.classList.contains("hidden")&&Q()}),n.attachBtn.addEventListener("click",()=>{if(!u){alert(a("pleaseSelectChat"));return}ne(),n.fileInputEl.value="",n.fileInputEl.accept="*/*",n.fileInputEl.click()}),n.fileInputEl.addEventListener("change",()=>{const y=n.fileInputEl.files[0];y&&ar(y)}),n.cancelReply.addEventListener("click",Te),n.membersBtnEl.addEventListener("click",cr),n.closeMembersBtn.addEventListener("click",Je),n.membersOverlayEl.addEventListener("click",y=>{y.target===n.membersOverlayEl&&Je()}),(p=n.membersTabBtn)==null||p.addEventListener("click",()=>fe("members")),(C=n.groupTabBtn)==null||C.addEventListener("click",()=>fe("group")),(_=n.refreshMembersBtn)==null||_.addEventListener("click",()=>Dt(!0)),(q=n.saveGroupBtn)==null||q.addEventListener("click",dr),(De=n.membersListEl)==null||De.addEventListener("click",handleMemberListClick),(Ne=n.chatListEl)==null||Ne.addEventListener("contextmenu",handleChatListContextMenu),(Ue=n.closeMemberModalBtn)==null||Ue.addEventListener("click",closeMemberModal),(Ae=n.memberModalEl)==null||Ae.addEventListener("click",y=>{y.target===n.memberModalEl&&closeMemberModal()}),(Pe=n.memberPromoteBtn)==null||Pe.addEventListener("click",()=>changeMemberRole("admin")),(Oe=n.memberModeratorBtn)==null||Oe.addEventListener("click",()=>changeMemberRole("moderator")),(Re=n.memberDemoteBtn)==null||Re.addEventListener("click",()=>changeMemberRole("member")),(Fe=n.memberRestrictBtn)==null||Fe.addEventListener("click",openRestrictModal),(He=n.memberKickBtn)==null||He.addEventListener("click",kickMemberFromModal),($e=n.closeRestrictModalBtn)==null||$e.addEventListener("click",closeRestrictModal),(Ke=n.restrictModalEl)==null||Ke.addEventListener("click",y=>{y.target===n.restrictModalEl&&closeRestrictModal()}),(je=n.applyRestrictBtn)==null||je.addEventListener("click",applyRestrictPermissions)}function re(){const e=b(u);if(N(v,u,n.emptyNoticeEl,n.chatListEl,w),e){ee(e,n.headerTitleEl,n.activeAvatarEl),kt(e,n.membersBtnEl);const t=S(e.id);ue(e,n.messagesEl,K,{canDeleteOthers:t.canDeleteMessages,isGroupChat:e.type==="group"||e.type==="supergroup",onUserClick:Le}),B.autoScroll&&F(n.messagesEl)}else ee(null,n.headerTitleEl,n.activeAvatarEl),ue(null,n.messagesEl)}function w(e){lt(e);const t=b(e);t?(t.unread=0,n.inputEl.disabled=!1,n.sendBtn.disabled=!1,n.attachBtn.disabled=!1,n.inputEl.placeholder=a("enterMessage"),n.inputEl.focus(),window.innerWidth<=768&&n.sidebarEl.classList.add("hidden-mobile")):(n.inputEl.disabled=!0,n.sendBtn.disabled=!0,n.attachBtn.disabled=!0,n.inputEl.placeholder=a("noConversationSelected")),n.newMsgBtn.style.display="none",re(),sr(e).catch(()=>{})}function Ws(){n.tokenInputEl.value=E,n.proxyInputEl.value=localStorage.getItem("cors_proxy")||"",n.overlayEl.classList.remove("hidden")}function Bt(){n.overlayEl.classList.add("hidden")}function Xs(){const e=n.tokenInputEl.value.trim(),t=n.proxyInputEl.value.trim();if(!e){n.settingsHintEl.textContent=a("enterToken");return}e!==E&&(kn(E),ln()),ct(e),Ze(e),et(t),localStorage.setItem("bot_token",e),t&&localStorage.setItem("cors_proxy",t),Bt(),Lt()}async function qs(){if(!E){n.settingsHintEl.textContent=a("tokenMissing");return}try{const e=await rt();e.ok?n.settingsHintEl.textContent=a("connectionOk",{username:e.result.username||a("connectionNoUsername"),id:e.result.id}):n.settingsHintEl.textContent=a("connectionFailed",{error:e.description||a("unknownError")})}catch(e){n.settingsHintEl.textContent=a("connectionNetworkError",{error:e.message})}}async function Vs(){if(E)try{const e=await qt(!1);n.settingsHintEl.textContent=e.ok?a("webhookDeleted"):a("webhookDeleteFailed",{error:e.description||a("unknownError")})}catch(e){n.settingsHintEl.textContent=a("webhookDeleteNetworkError",{error:e.message})}}async function Js(){try{const t=await Ts()==="granted";n.settingsHintEl.textContent=a(t?"notificationsGranted":"notificationsDenied"),z("push",t)}catch(e){n.settingsHintEl.textContent=a("error")+": "+e.message}}function z(e,t,o=!0){e in te&&(B={...B,[e]:t},o&&Qs(),It())}function zs(){try{const e=JSON.parse(localStorage.getItem("ui_preferences")||"{}");return{...te,...e}}catch{return{...te}}}function Qs(){try{localStorage.setItem("ui_preferences",JSON.stringify(B))}catch(e){console.warn("Kh√¥ng th·ªÉ l∆∞u tu·ª≥ ch·ªçn UI:",e)}}function It(){n.prefAutoScrollEl&&(n.prefAutoScrollEl.checked=!!B.autoScroll),n.prefSoundEl&&(n.prefSoundEl.checked=!!B.sound),n.prefPushEl&&(n.prefPushEl.checked=!!B.push)}function _t(e){return e==="system"?L&&L.matches?"dark":"light":e}function O(e,t=!0){G=e,t&&Bn(e);const o=_t(e);document.body.dataset.theme=o,document.body.dataset.themePreference=e,Mt(e),wt(o)}function Mt(e){const t={light:n.themeOptionLight,dark:n.themeOptionDark,system:n.themeOptionSystem};Object.entries(t).forEach(([o,s])=>{s&&(o===e?s.classList.add("active"):s.classList.remove("active"))})}function wt(e){n.themeToggleBtn&&(n.themeToggleBtn.textContent=e==="dark"?"üåô":"üåû")}function Zs(){const e=["light","dark","system"],t=e.indexOf(G),o=e[(t+1)%e.length];O(o)}function We(){G==="system"&&O("system",!1)}function Xe(e){Ln(e),Tt(),St(e),re()}function St(e){const t={en:n.langOptionEn,vi:n.langOptionVi};Object.entries(t).forEach(([o,s])=>{s&&(o===e?s.classList.add("active"):s.classList.remove("active"))})}function Tt(){document.querySelectorAll("[data-i18n]").forEach(t=>{const o=t.getAttribute("data-i18n");o&&(t.textContent=a(o))}),n.openChatInputEl&&(n.openChatInputEl.placeholder=a("enterChatId")),n.inputEl&&(u?n.inputEl.placeholder=a("enterMessage"):n.inputEl.placeholder=a("noConversationSelected")),n.tokenInputEl&&(n.tokenInputEl.placeholder=a("botToken")),n.proxyInputEl&&(n.proxyInputEl.placeholder=a("corsProxy")),n.settingsBtn&&(n.settingsBtn.title=a("settingsTitle"),n.settingsBtn.setAttribute("aria-label",a("settingsTitle"))),n.themeToggleBtn&&(n.themeToggleBtn.title=a("changeTheme"),n.themeToggleBtn.setAttribute("aria-label",a("changeTheme"))),n.openChatBtnEl&&(n.openChatBtnEl.title=a("openChat"),n.openChatBtnEl.setAttribute("aria-label",a("openChat"))),n.sendBtn&&(n.sendBtn.title=a("send"),n.sendBtn.setAttribute("aria-label",a("send"))),n.attachBtn&&(n.attachBtn.title=a("attach"),n.attachBtn.setAttribute("aria-label",a("attach"))),n.stickerBtn&&(n.stickerBtn.title=a("sticker"),n.stickerBtn.setAttribute("aria-label",a("sticker"))),n.membersBtnEl&&(n.membersBtnEl.title=a("manageMembers"),n.membersBtnEl.setAttribute("aria-label",a("manageMembers"))),n.cancelReply&&n.cancelReply.setAttribute("aria-label",a("cancelReply")),St(Tn())}function er(){return[a("featureThemes"),a("featurePushNotifications"),a("featureChatHistory"),a("featureMemberManagement"),a("featureSendMessages")]}async function Lt(){var e,t,o,s,r;if(!E){n.statusEl.textContent=a("statusDisconnected");return}n.statusEl.textContent=a("statusConnecting");try{const i=await rt();if(i.ok){const[c,l,m]=await Promise.allSettled([Vt(),Jt(),zt()]),f=c.status==="fulfilled"&&((e=c.value)!=null&&e.ok)?c.value.result||[]:[],d=l.status==="fulfilled"&&((t=l.value)!=null&&t.ok)&&((o=l.value.result)==null?void 0:o.description)||null,h=m.status==="fulfilled"&&((s=m.value)!=null&&s.ok)&&((r=m.value.result)==null?void 0:r.short_description)||null,p={id:i.result.id,username:i.result.username||null,name:[i.result.first_name,i.result.last_name].filter(Boolean).join(" ")||i.result.username||"Bot",commands:f,description:d,shortDescription:h};mt(p),yn(E,p),xt(),tr()}else n.statusEl.textContent="L·ªói getMe: "+(i.description||"Kh√¥ng r√µ")}catch{n.statusEl.textContent="CORS ho·∫∑c m·∫°ng l·ªói khi getMe"}}function xt(){const e=M;if(e.username?n.botInfoEl.textContent="@"+e.username:e.id?n.botInfoEl.textContent="Bot ID: "+e.id:n.botInfoEl.textContent="",n.botDetailNameEl&&(n.botDetailNameEl.textContent=e.name||"‚Äî"),n.botDetailUsernameEl&&(n.botDetailUsernameEl.textContent=e.username?"@"+e.username:"‚Äî"),n.botDetailIdEl&&(n.botDetailIdEl.textContent=e.id||"‚Äî"),n.botDetailDescriptionEl&&(n.botDetailDescriptionEl.textContent=e.description||"‚Äî"),n.botDetailShortDescriptionEl&&(n.botDetailShortDescriptionEl.textContent=e.shortDescription||"‚Äî"),n.botCommandsListEl)if(n.botCommandsListEl.innerHTML="",Array.isArray(e.commands)&&e.commands.length)e.commands.forEach(t=>{const o=document.createElement("li");o.textContent=`/${t.command}${t.description?" ‚Äî "+t.description:""}`,n.botCommandsListEl.appendChild(o)});else{const t=document.createElement("li");t.textContent="Kh√¥ng c√≥ l·ªánh m·∫∑c ƒë·ªãnh",n.botCommandsListEl.appendChild(t)}n.botFeatureListEl&&(n.botFeatureListEl.innerHTML="",er().forEach(t=>{const o=document.createElement("li");o.textContent=t,n.botFeatureListEl.appendChild(o)})),Mt(G),wt(_t(G))}function tr(){clearInterval(js),J=!0,he(),n.statusEl.textContent="ƒêang nh·∫≠n c·∫≠p nh·∫≠t..."}async function he(){if(J)try{await nr(),setTimeout(()=>{J&&he()},1e3)}catch(e){console.error("Polling error:",e),setTimeout(()=>{J&&he()},2e3)}}async function nr(){try{const e=await Pt(ve||void 0);if(!e.ok){n.statusEl.textContent=a("getUpdatesError",{error:e.description||a("unknownError")}),String(e.error_code)==="409"&&(n.statusEl.textContent=a("webhookActive"));return}for(const t of e.result||[]){dt(t.update_id+1),vn(t.update_id+1);const o=t.message||t.edited_message||t.channel_post||t.edited_channel_post;!o||!o.chat||await or(o)}n.statusEl.textContent=a("statusConnected")}catch(e){throw n.statusEl.textContent=a("corsError"),e}}async function or(e){const t=e.chat,o=String(t.id),r=t.type==="private"?[t.first_name,t.last_name].filter(Boolean).join(" ")||t.username||a("user"):t.title||t.type||"Chat",i=H(o,{type:t.type,title:r,avatarText:R(r)});t.title&&t.title!==i.title&&(i.title=t.title,i.avatarText=R(t.title),u===o&&ee(i,n.headerTitleEl,n.activeAvatarEl)),t.type&&t.type!==i.type&&(i.type=t.type);const c=(e.date||Math.floor(Date.now()/1e3))*1e3;e.from&&de(o,{id:e.from.id,first_name:e.from.first_name,last_name:e.from.last_name,username:e.from.username,isBot:e.from.is_bot,status:e.from.is_bot?"bot":"member",lastSeen:c}),Array.isArray(e.new_chat_members)&&e.new_chat_members.length&&e.new_chat_members.forEach(p=>{de(o,{id:p.id,first_name:p.first_name,last_name:p.last_name,username:p.username,isBot:p.is_bot,status:p.is_bot?"bot":"member",joinedDate:c,lastSeen:c})}),e.left_chat_member&&mn(o,e.left_chat_member.id);const l=u===o,m=l?be(n.messagesEl):!1,f=e.from&&M.id&&e.from.id===M.id,d={id:e.message_id,side:f?"right":"left",date:c,fromId:e.from?e.from.id:null,fromName:Zt(e),fromUsername:en(e),reply_to:e.reply_to_message&&e.reply_to_message.message_id,reply_preview:e.reply_to_message&&oe(e.reply_to_message.text||e.reply_to_message.caption||"")};let h;if(e.text)h={...d,type:"text",text:e.text};else if(e.photo){const p=e.photo[e.photo.length-1],C=await I(p.file_id);h={...d,type:"photo",mediaUrl:C,caption:e.caption||""}}else if(e.video){const p=await I(e.video.file_id);h={...d,type:"video",mediaUrl:p,caption:e.caption||""}}else if(e.audio){const p=await I(e.audio.file_id);h={...d,type:"audio",mediaUrl:p,caption:e.caption||""}}else if(e.voice){const p=await I(e.voice.file_id);h={...d,type:"voice",mediaUrl:p,caption:e.caption||""}}else if(e.document){const p=await I(e.document.file_id);h={...d,type:"document",mediaUrl:p,caption:e.caption||"",fileName:e.document.file_name||"T·ªáp"}}else if(e.sticker){const p=e.sticker;let C="tgs",_="";p.is_video?(C="webm",_=await I(p.file_id)):p.is_animated||(C="webp",_=await I(p.file_id));const q={file_id:p.file_id,url:_,emoji:p.emoji||"",is_animated:p.is_animated,is_video:p.is_video,set_name:p.set_name,width:p.width,height:p.height};_n(E,q),h={...d,type:"sticker",mediaUrl:_,stickerFormat:C,emoji:p.emoji||""}}else h={...d,type:"text",text:a("unsupportedContent")};if(se(o,h)){if(l){const p=S(o),C=b(o),_=C&&(C.type==="group"||C.type==="supergroup");X(h,n.messagesEl,K,{canDeleteOthers:p.canDeleteMessages,isGroupChat:_,onUserClick:Le}),B.autoScroll&&m?(F(n.messagesEl),n.newMsgBtn.style.display="none"):_e(n.newMsgBtn,n.messagesEl)}else i.unread=(i.unread||0)+1,Ss(i,h,n.toastsEl,{playSound:B.sound,push:B.push,scrollToMessage:window.scrollToMessage});N(v,u,n.emptyNoticeEl,n.chatListEl,w,Nt),l&&kt(i,n.membersBtnEl),D(E,v)}}async function sr(e){if(!e||!M.id)return S(e);try{const t=await Yt(e,M.id);if(t.ok){const o=t.result,s={canDeleteMessages:!!o.can_delete_messages,canPromoteMembers:!!o.can_promote_members,canRestrictMembers:!!o.can_restrict_members,canChangeInfo:!!o.can_change_info,canInviteUsers:!!o.can_invite_users};return un(e,s),s}}catch(t){console.warn("Kh√¥ng l·∫•y ƒë∆∞·ª£c quy·ªÅn bot:",t)}return S(e)}async function I(e){try{const t=await it(e);if(!t.ok)throw new Error(t.description);return nt(t.result.file_path)}catch(t){return console.error("Failed to get file URL:",t),""}}function rr(e){if(e.target.closest(".msg-action-btn"))return;if(e.target.closest(".msg-sender-name")){const r=e.target.closest(".msg-sender-name"),i=parseInt(r.dataset.userId,10);if(i&&Se()){showMemberModal(i);return}}const t=e.target.closest(".message");if(!t)return;const o=t.dataset.msgId,s=t.innerText.slice(0,30).replace("/ /g"," ");ir(o,s)}function Se(){if(!u)return!1;const e=b(u);if(!e||e.type!=="group"&&e.type!=="supergroup")return!1;const t=S(u);return t.canRestrictMembers||t.canPromoteMembers}function ir(e,t){an(e),n.replyText.textContent=t,n.replyContext.classList.remove("hidden")}function Te(){cn(),n.replyContext.classList.add("hidden")}async function qe(){const e=n.inputEl.value.trim();if(!e)return;if(!E){alert(a("needToken"));return}if(!u){alert(a("pleaseSelectConversation"));return}const t={chat_id:u,text:e};A&&(t.reply_to_message_id=parseInt(A,10));const o=be(n.messagesEl);n.inputEl.value="",Te(),ne();try{const s=await k("sendMessage",t);if(s.ok){const r=s.result,i={id:r.message_id,side:"right",type:"text",text:e,date:r.date*1e3,fromName:a("you"),reply_to:t.reply_to_message_id,reply_preview:A?oe(e):null},c=u;if(H(c),se(c,i)){const l=S(c);X(i,n.messagesEl,K,{canDeleteOthers:l.canDeleteMessages,canManageMembers:Se()}),B.autoScroll&&o?(F(n.messagesEl),n.newMsgBtn.style.display="none"):_e(n.newMsgBtn,n.messagesEl),N(v,u,n.emptyNoticeEl,n.chatListEl,w),D(E,v)}}else alert(a("messageSendFailed",{error:s.description||a("unknownError")}))}catch(s){alert(a("networkError",{error:s.message}))}}async function ar(e){if(!e||!u){alert(a("selectFile"));return}const t=n.inputEl.value.trim();n.inputEl.value="",Te(),ne();const o=new FormData;o.append("chat_id",u),t&&o.append("caption",t);let s="sendDocument",r="document",i="document";e.type.startsWith("image/")?(s="sendPhoto",r="photo",i="photo"):e.type.startsWith("video/")?(s="sendVideo",r="video",i="video"):e.type.startsWith("audio/")&&(s="sendAudio",r="audio",i="audio"),o.append(r,e,e.name||void 0);const c=be(n.messagesEl);try{const l=await st(s,o);if(l.ok){const m=l.result;let f="",d=e.name||"";if(i==="photo"){const C=m.photo[m.photo.length-1];f=await I(C.file_id)}else i==="video"?f=await I(m.video.file_id):i==="audio"?f=await I(m.audio.file_id):(f=await I(m.document.file_id),d=m.document.file_name||d);const h={id:m.message_id,side:"right",type:i,mediaUrl:f,caption:t,fileName:d,date:m.date*1e3,fromName:a("you")},p=u;if(H(p),se(p,h)){const C=S(p);X(h,n.messagesEl,K,{canDeleteOthers:C.canDeleteMessages,canManageMembers:Se()}),B.autoScroll&&c?(F(n.messagesEl),n.newMsgBtn.style.display="none"):_e(n.newMsgBtn,n.messagesEl),N(v,u,n.emptyNoticeEl,n.chatListEl,w),D(E,v)}}else alert(a("fileSendFailed",{error:l.description||a("unknownError")}))}catch(l){alert(a("networkError",{error:l.message}))}}async function K(e){if(!confirm(a("confirmDelete")))return;const t=u;if(t)try{const o=await Ft(t,e);if(o.ok){pn(t,e);const s=b(t),r=S(t);ue(s,n.messagesEl,K,{canDeleteOthers:r.canDeleteMessages,isGroupChat:s.type==="group"||s.type==="supergroup",onUserClick:Le}),N(v,u,n.emptyNoticeEl,n.chatListEl,w),D(E,v),g(a("success"),a("messageDeleted"),n.toastsEl)}else{const s=o.description||a("cannotDeleteMessage");g(a("error"),s,n.toastsEl)}}catch(o){g(a("error"),a("networkError",{error:o.message}),n.toastsEl)}}async function Ve(){var t;const e=(t=n.openChatInputEl)==null?void 0:t.value.trim();if(!e){g(a("warning"),a("enterChatIdOrUsername"),n.toastsEl);return}try{let o=e;if(e.startsWith("@")){const r=e.substring(1);g(a("searching"),a("searchingForUser",{username:r}),n.toastsEl),o="@"+r}const s=await Ht(o);if(s.ok){const r=s.result,i=String(r.id),l=r.type==="private"?[r.first_name,r.last_name].filter(Boolean).join(" ")||r.username||a("user"):r.title||r.type||"Chat";b(i)||(H(i,{type:r.type,title:l,avatarText:R(l)}),g(a("found"),l,n.toastsEl)),N(v,u,n.emptyNoticeEl,n.chatListEl,w),w(i),n.openChatInputEl&&(n.openChatInputEl.value="")}else g(a("notFound"),s.description||a("chatNotFound"),n.toastsEl)}catch(o){g(a("error"),a("searchError",{error:o.message}),n.toastsEl)}}function cr(){if(!u)return;const e=b(u);!e||e.type!=="group"&&e.type!=="supergroup"||(n.membersOverlayEl.classList.remove("hidden"),fe(Ct),Dt(!1))}function Je(){n.membersOverlayEl.classList.add("hidden")}function fe(e){var t,o,s,r,i,c,l,m;Ct=e,e==="members"?((t=n.membersTabBtn)==null||t.classList.add("active"),(o=n.groupTabBtn)==null||o.classList.remove("active"),(s=n.membersTabPanel)==null||s.classList.add("active"),(r=n.groupSettingsTab)==null||r.classList.remove("active")):((i=n.membersTabBtn)==null||i.classList.remove("active"),(c=n.groupTabBtn)==null||c.classList.add("active"),(l=n.membersTabPanel)==null||l.classList.remove("active"),(m=n.groupSettingsTab)==null||m.classList.add("active"),lr())}function lr(){const e=b(u);e&&(n.groupNameInputEl&&(n.groupNameInputEl.value=e.title||""),n.groupDescriptionInputEl&&(n.groupDescriptionInputEl.value=e.description||""))}async function dr(){var s,r,i;if(!u)return;const e=(s=n.groupNameInputEl)==null?void 0:s.value.trim(),t=(r=n.groupDescriptionInputEl)==null?void 0:r.value.trim(),o=(i=n.groupPhotoInputEl)==null?void 0:i.files[0];try{if(e&&(await Fs(u,e)).ok){const l=b(u);l&&(l.title=e,re()),g("‚úÖ Th√†nh c√¥ng","ƒê√£ c·∫≠p nh·∫≠t t√™n nh√≥m",n.toastsEl)}if(t&&(await Hs(u,t)).ok){const l=b(u);l&&(l.description=t),g("‚úÖ Th√†nh c√¥ng","ƒê√£ c·∫≠p nh·∫≠t m√¥ t·∫£",n.toastsEl)}o&&(await $s(u,o)).ok&&g("‚úÖ Th√†nh c√¥ng","ƒê√£ c·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán",n.toastsEl)}catch(c){g("‚ùå L·ªói",c.message,n.toastsEl)}}async function Dt(e=!0){if(u)try{const t=await Os(u),o=b(u);t.forEach(r=>{de(u,{id:r.user.id,first_name:r.user.first_name,last_name:r.user.last_name,username:r.user.username,isBot:r.user.is_bot,status:r.status,isAdmin:r.status==="administrator",isCreator:r.status==="creator",raw:r})}),mr();const s=ut(u).length;n.groupInfoEl&&(n.groupInfoEl.textContent=`T·ªïng: ${s} th√†nh vi√™n`),e&&g("‚úÖ Th√†nh c√¥ng","ƒê√£ t·∫£i l·∫°i danh s√°ch",n.toastsEl)}catch(t){n.membersHintEl&&(n.membersHintEl.textContent="L·ªói: "+t.message),e&&g("‚ùå L·ªói",t.message,n.toastsEl)}}function mr(){if(!n.membersListEl)return;n.membersListEl.innerHTML="",ut(u).forEach(t=>{const o=document.createElement("div");o.className="member-item",o.dataset.userId=t.id;const s=document.createElement("div");s.className="member-avatar",s.textContent=t.avatarText||"?";const r=document.createElement("div");r.className="member-info";const i=document.createElement("div");i.className="member-name",i.textContent=t.displayName||"Ng∆∞·ªùi d√πng";const c=document.createElement("div");c.className="member-status",c.textContent=Ks(t.status),r.appendChild(i),r.appendChild(c),o.appendChild(s),o.appendChild(r),n.membersListEl.appendChild(o)})}function ze(){!u||!E||Ot(u,"typing").catch(()=>{})}function ur(){ze(),pe=setInterval(ze,4e3)}function ne(){clearInterval(pe),pe=null}async function Nt(e){e&&(rn(e),D(E,v),u===e&&(lt(null),Dn(n.messagesEl),ee(null,n.headerTitleEl,n.activeAvatarEl),n.inputEl.disabled=!0),N(v,u,n.emptyNoticeEl,n.chatListEl,w,Nt),g("Th√†nh c√¥ng","ƒê√£ x√≥a chat",n.toastsEl))}function Le(e,t,o=null){if(!e||!u)return;const s=b(u);!s||s.type!=="group"&&s.type!=="supergroup"||(window.currentUserAction={userId:e,userName:t,userUsername:o,chatId:u},pr(t,o,e))}function pr(e,t=null,o=null){const s=[];s.push(`<strong>${e}</strong>`),t&&s.push(`@${t}`),o&&s.push(`ID: ${o}`),n.userActionsTitle.innerHTML=s.join(" ‚Ä¢ "),n.userActionsMenu.classList.remove("hidden")}function Q(){n.userActionsMenu.classList.add("hidden"),window.currentUserAction=null}async function T(e){if(!window.currentUserAction)return;const{userId:t,userName:o,userUsername:s,chatId:r}=window.currentUserAction;try{switch(e){case"copyId":t&&navigator.clipboard.writeText(t.toString()).then(()=>{g("Th√†nh c√¥ng",`ƒê√£ copy ID: ${t}`,n.toastsEl)}).catch(()=>{g("L·ªói","Kh√¥ng th·ªÉ copy ID",n.toastsEl)});break;case"copyUsername":if(s){const i=s.startsWith("@")?s:`@${s}`;navigator.clipboard.writeText(i).then(()=>{g("Th√†nh c√¥ng",`ƒê√£ copy username: ${i}`,n.toastsEl)}).catch(()=>{g("L·ªói","Kh√¥ng th·ªÉ copy username",n.toastsEl)})}else g("Th√¥ng b√°o","Ng∆∞·ªùi d√πng kh√¥ng c√≥ username",n.toastsEl);break;case"kick":confirm(`Kick ${o} kh·ªèi nh√≥m?`)&&(await Rs(r,t),g("Th√†nh c√¥ng",`ƒê√£ kick ${o}`,n.toastsEl));break;case"promote":await le(r,t,"admin"),g("Th√†nh c√¥ng",`ƒê√£ thƒÉng ${o} l√†m admin`,n.toastsEl);break;case"moderate":await le(r,t,"moderator"),g("Th√†nh c√¥ng",`ƒê√£ thƒÉng ${o} l√†m moderator`,n.toastsEl);break;case"demote":await le(r,t,"member"),g("Th√†nh c√¥ng",`ƒê√£ h·∫° ${o} th√†nh th√†nh vi√™n`,n.toastsEl);break;case"restrict":g("Th√¥ng b√°o","T√≠nh nƒÉng h·∫°n ch·∫ø quy·ªÅn ƒëang ph√°t tri·ªÉn",n.toastsEl);break}}catch(i){g("L·ªói",`Kh√¥ng th·ª±c hi·ªán t√°c v·ª•: ${i.message}`,n.toastsEl)}Q()}function hr(){n.stickerPanel.classList.contains("hidden")?fr():xe()}function fr(){n.stickerPanel.classList.remove("hidden");const e=yt(E);Promise.all(e.map(async o=>{if(!o.url&&o.file_id)try{const s=await it(o.file_id);s.ok&&(o.url=nt(s.result.file_path))}catch(s){console.warn("Failed to get sticker URL:",s)}return o})).then(o=>{Nn(o,n.stickerList,gr)})}function xe(){n.stickerPanel.classList.add("hidden")}async function gr(e){if(!u){g("L·ªói","Ch·ªçn chat tr∆∞·ªõc",n.toastsEl);return}try{await Rt(u,e.file_id),xe();const t={id:Date.now(),side:"right",date:Date.now(),fromName:M.name||"Bot",type:"sticker",mediaUrl:e.url,stickerFormat:e.is_animated?"tgs":e.is_video?"webm":"webp",emoji:e.emoji||""};se(u,t),X(t,n.messagesEl,K,{canDeleteOthers:!1,isGroupChat:!1}),F(n.messagesEl)}catch(t){g("L·ªói",`Kh√¥ng g·ª≠i sticker: ${t.message}`,n.toastsEl)}}window.scrollToMessage=function(e,t){u!==e&&w(e),setTimeout(()=>{const o=document.querySelector(`[data-msg-id="${t}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.style.animation="pulse 1s ease-in-out",setTimeout(()=>{o.style.animation=""},1e3))},500)};function Qe(){if(!n||!n.sidebarCloseBtn)return;window.innerWidth<=840?n.sidebarCloseBtn.style.display="grid":n.sidebarCloseBtn.style.display="none"}document.addEventListener("DOMContentLoaded",Ys);window.addEventListener("beforeunload",()=>{E&&D(E,v)});
